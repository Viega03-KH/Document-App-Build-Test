import{k as E,_ as P,d as I,J as C,s as X,a as u,o as r,p as y,t as N,v as d,b as s,g as n,f as l,q as j,S as O,h,F as B,x as L,T as G,E as H,A as J,G as Q,u as R,l as W,r as Y,Q as b,w as U,V as K,W as Z,X as ee,c as te,Y as se,j as D}from"./index-CDbZ6Fa9.js";import{u as ae}from"./MultiColumnUserSelect.vue_vue_type_style_index_0_scoped_1fefd64e_lang-gPo00AIL.js";import{u as le}from"./usersStore-CKquJ-N2.js";import{U as oe}from"./user-DCLnJ75f.js";import{u as ie,X as ne,P as re}from"./useFormValidate-kLZtjoVo.js";/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=E("user-round-minus",[["path",{d:"M2 21a8 8 0 0 1 13.292-6",key:"bjp14o"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M22 19h-6",key:"vcuq98"}]]),ue={class:"flex flex-col gap-1 w-full"},ce={key:0,class:"text-md font-bold text-dark"},me={class:"relative select-none"},pe={key:0,class:"flex items-center gap-3"},fe={class:"flex items-center justify-center w-10 h-10 rounded-full bg-blue-500 text-white font-bold text-sm uppercase"},xe={class:"flex flex-col text-sm"},ge={class:"font-medium"},_e={class:"text-gray-500 text-xs"},he={key:1,class:"flex flex-row gap-1"},be={class:"text-gray-400"},ye={key:0,class:"absolute mt-2 w-full max-h-80 overflow-y-auto bg-white border border-gray-300 rounded-lg shadow-lg z-50"},ve={class:"py-1"},ke=["onClick"],we={class:"flex items-center justify-center w-10 h-10 rounded-full bg-blue-500 text-white font-bold text-sm uppercase"},Ve={class:"flex flex-col text-sm"},Se={class:"font-medium"},Te={class:"text-xs"},je={key:0,class:"p-4 text-gray-500 italic"},Ue={key:1,class:"text-md italic text-red-500"},Ce={__name:"MultiColumnUserSelect",props:{modelValue:[Number,null],options:{type:Array,default:()=>[]},labelFirstname:{type:String,default:"firstname"},labelLastname:{type:String,default:"lastname"},labelDepartment:{type:String,default:"department_name"},optionValue:{type:String,default:"user_id"},placeholder:{type:String,default:"Foydalanuvchini tanlang"},label:String,error:String},emits:["update:modelValue"],setup(t,{emit:S}){const x=t,v=S,p=I(!1),_=C({get:()=>x.modelValue,set:c=>v("update:modelValue",c)}),o=C(()=>x.options.find(c=>c[x.optionValue]===_.value)),k=c=>{_.value=c[x.optionValue],p.value=!1},a=()=>{p.value=!1};return(c,w)=>{const g=X("click-outside");return r(),u("div",ue,[t.label?(r(),u("label",ce,d(t.label),1)):y("",!0),N((r(),u("div",me,[s("div",{onClick:w[0]||(w[0]=f=>p.value=!p.value),class:j(["appearance-none border border-[rgba(226,230,245,1)] shadow-sm card-dark rounded-[16px] px-[24px] py-[12px] outline-none w-full cursor-pointer transition-all flex items-center justify-between",{"ring-1 ring-blue-400 border-blue-400":p.value}])},[o.value?(r(),u("div",pe,[s("div",fe,d(o.value[t.labelFirstname][0])+d(o.value[t.labelLastname][0]),1),s("div",xe,[s("span",ge,d(o.value[t.labelFirstname])+" "+d(o.value[t.labelLastname]),1),s("span",_e,d(o.value[t.labelDepartment]),1)])])):(r(),u("div",he,[n(l(oe),{class:"text-gray-400"}),s("span",be,d(t.placeholder),1)])),n(l(O),{"stroke-width":2,class:j(["text-gray-400 transition-transform duration-200",{"rotate-180":p.value}])},null,8,["class"])],2),n(G,{name:"fade"},{default:h(()=>[p.value?(r(),u("div",ye,[s("ul",ve,[(r(!0),u(B,null,L(t.options,f=>(r(),u("li",{key:f[t.optionValue],onClick:q=>k(f),class:j(["px-4 py-2 cursor-pointer flex items-center gap-3 hover:bg-gray-100 transition-colors",{"bg-blue-500 text-white":f[t.optionValue]===_.value}])},[s("div",we,d(f[t.labelFirstname][0])+d(f[t.labelLastname][0]),1),s("div",Ve,[s("span",Se,d(f[t.labelFirstname])+" "+d(f[t.labelLastname]),1),s("span",Te,d(f[t.labelDepartment]),1)])],10,ke))),128))]),t.options.length?y("",!0):(r(),u("p",je," Foydalanuvchilar mavjud emas. "))])):y("",!0)]),_:1})])),[[g,a]]),t.error?(r(),u("p",Ue,d(t.error),1)):y("",!0)])}}},qe=P(Ce,[["__scopeId","data-v-1fefd64e"]]),$e=()=>H.get("/task_type_list"),Fe=J("tasktayps",{state:()=>({tasktayps:[],loading:!1,error:null}),actions:{async fetchAll(){this.loading=!0,this.error=null;try{const t=await $e();this.tasktayps=t.data}catch(t){this.error=t,console.error("Tasktayplarni olishda xato:",t)}finally{this.loading=!1}}}}),Me={class:"w-[50vw] h-[80vh] flex flex-col bg-white rounded-xl shadow-lg"},De={class:"flex justify-between items-center p-4 border-b"},Ie={class:"p-6 h-[calc(80vh-64px)] overflow-y-scroll space-y-6"},Ne={class:"grid grid-cols-3 gap-4"},Be={class:"space-y-3"},Le={class:"flex justify-start gap-4 items-center py-4"},ze={class:"flex items-center gap-3"},Ae={class:"relative inline-flex items-center cursor-pointer"},Ee={class:"flex justify-end gap-3 p-4 border-t"},Je={__name:"CreateTaskForm",props:{id:{type:Number,required:!1,default:null},existingTask:{type:Object,default:null}},setup(t){const S=Q(),x=ae(),v=le(),p=Fe(),_=R(),o=t,k=C(()=>v.users||[]);W(()=>{console.log(o.existingTask),p.fetchAll(),v.fetchUsersNotPage()});const{form:a,errors:c,validate:w}=ie({incoming_documents_id:o.id||o.existingTask?.incoming_documents_id||null,item_number:o.existingTask?.item_number||"",task_type_id:o.existingTask?.task_type_id||"",deadline_end:o.existingTask?.deadline_end||"",description:o.existingTask?.description||"",executor:o.existingTask?.executor?.length?o.existingTask.executor.map(i=>({user_id:i.user_id,departments_id:i.departments_id})):[{user_id:null,departments_id:11}]},{item_number:{required:!0,message:"Status raqami majburiy"},task_type_id:{required:!0,message:"Ijro holati majburiy"},deadline_end:{required:!0,message:"Sanani kiriting"},description:{required:!0,message:"Topshiriq mazmuni majburiy"},executor:{custom:i=>i.every(e=>e.user_id)?"":"Ijrochi tanlanishi shart"}}),g=I(!1),f=()=>{g.value?a.executor=k.value.map(i=>({user_id:i.user_id,departments_id:i.department_id||11})):a.executor=[{user_id:null,departments_id:11}]},q=()=>{g.value||a.executor.unshift({user_id:null,departments_id:11})},z=i=>{a.executor.length>1&&a.executor.splice(i,1)},T=()=>S.close(),A=i=>i?`${i} 10:00`:"",$=async()=>{if(!w())return;const i={incoming_documents_id:a.incoming_documents_id,item_number:Number(a.item_number),task_type_id:Number(a.task_type_id),deadline_end:A(a.deadline_end),description:a.description,executor:a.executor.map(V=>({user_id:V.user_id,departments_id:V.departments_id}))};let e;o.existingTask?.id?e=await x.update(o.existingTask.id,i):e=await x.createTask(i),e?(_.show(x.lastMessage||"Task saqlandi","success"),T()):_.show(x.lastMessage||"Xatolik yuz berdi","error")};return(i,e)=>{const V=Y("USelect");return r(),u("div",Me,[s("div",De,[e[5]||(e[5]=s("p",{class:"font-bold uppercase text-md"},"Topshiriq yaratish",-1)),n(b,{class:"bg-gray-700 rounded-full p-1",onClick:T},{default:h(()=>[n(l(ne),{class:"w-3 h-3 text-white","stroke-width":"3"})]),_:1})]),s("div",Ie,[s("form",{onSubmit:U($,["prevent"]),class:"grid gap-4"},[s("div",Ne,[n(K,{modelValue:l(a).item_number,"onUpdate:modelValue":e[0]||(e[0]=m=>l(a).item_number=m),label:"Band",placeholder:"Hujjat band raqami kiriting",error:l(c).item_number},null,8,["modelValue","error"]),n(V,{modelValue:l(a).task_type_id,"onUpdate:modelValue":e[1]||(e[1]=m=>l(a).task_type_id=m),options:l(p).tasktayps,label:"Ijro holati",placeholder:"Ijro holati kiriting","option-label":"name_oz","option-value":"id",loading:l(p).loading,error:l(c).task_type_id},null,8,["modelValue","options","loading","error"]),n(Z,{modelValue:l(a).deadline_end,"onUpdate:modelValue":e[2]||(e[2]=m=>l(a).deadline_end=m),label:"Boshlanish sanasi",placeholder:"Sanani kiriting",error:l(c).deadline_end},null,8,["modelValue","error"])]),s("div",Be,[s("div",Le,[n(b,{variant:"ghost",onClick:U(q,["prevent"])},{default:h(()=>[n(l(re),{class:"w-4 h-4 text-gray-700","stroke-width":"2.5"}),e[6]||(e[6]=s("span",{class:"px-2 text-gray-700 font-semibold"},"Ijrochi qoâ€˜shish",-1))]),_:1}),s("div",ze,[s("label",Ae,[N(s("input",{type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=m=>g.value=m),class:"sr-only peer",onChange:f},null,544),[[ee,g.value]]),e[7]||(e[7]=s("div",{class:"w-11 h-6 bg-gray-300 rounded-full peer-checked:bg-blue-600 transition-colors duration-300"},null,-1)),e[8]||(e[8]=s("div",{class:"absolute left-0.5 top-0.5 w-5 h-5 bg-white rounded-full shadow-md peer-checked:translate-x-5 transform transition-transform duration-300"},null,-1)),e[9]||(e[9]=s("span",{class:"ml-3 text-gray-700 select-none"},"Barcha xodimlar",-1))])])]),(r(!0),u(B,null,L(l(a).executor,(m,F)=>(r(),u("div",{key:F,class:"flex items-center gap-2"},[n(qe,{modelValue:m.user_id,"onUpdate:modelValue":M=>m.user_id=M,options:k.value,labelFirstname:"firstname",labelLastname:"lastname",labelDepartment:"department_name","option-value":"user_id",placeholder:"Ijrochi tanlang",class:"flex-1",error:l(c).executor},null,8,["modelValue","onUpdate:modelValue","options","error"]),!g.value&&l(a).executor.length>1?(r(),te(b,{key:0,variant:"hover",onClick:U(M=>z(F),["prevent"])},{default:h(()=>[n(l(de),{class:"w-4 h-4"})]),_:1},8,["onClick"])):y("",!0)]))),128))]),n(se,{modelValue:l(a).description,"onUpdate:modelValue":e[4]||(e[4]=m=>l(a).description=m),label:"Topshiriq mazmuni",rows:"4",placeholder:"Topshiriq mazmuni...",error:l(c).description},null,8,["modelValue","error"])],32)]),s("div",Ee,[n(b,{variant:"ghost",onClick:T},{default:h(()=>[...e[10]||(e[10]=[D("Bekor qilish",-1)])]),_:1}),n(b,{variant:"primary",onClick:$},{default:h(()=>[...e[11]||(e[11]=[D("Saqlash va yuborish",-1)])]),_:1})])])}}};export{Je as _};
