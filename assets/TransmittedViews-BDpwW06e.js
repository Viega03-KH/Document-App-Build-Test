import{d as he}from"./dayjs.min-DZBr1Buc.js";import{a as E,u as G,H as ge,_ as $,b as ve,T as ye,U as pe,S as be,L as _e}from"./UStatus-BqHHNLfN.js";import{a as Q,N as H,B as I,r as V,e as g,o as m,i as t,g as d,F as P,b as U,D as re,s as C,f as l,t as T,h as D,z as Y,c as F,L as R,u as J,m as W,j as y,w as K,v as ie,H as ke,M as N,y as se,x as xe}from"./index-CJXrJkbj.js";import{u as ne,X as Z,a as we,S as je}from"./usersStore-C4mLOTpv.js";import{_ as Se}from"./UPagination-B2WzX-PT.js";import"./chevron-right-2wuyl-Gm.js";/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=Q("circle-plus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=Q("paperclip",[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]]);/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=Q("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=Q("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]),Ue=()=>H.get("/organizations_list"),ee=I("organizations",{state:()=>({organizations:[],selectedOrganizations:null,loading:!1,error:null}),actions:{async fetchAll(){try{this.loading=!0;const e=await Ue();this.organizations=e.data}catch(e){this.error=e,console.error("Organizations olishda xato:",e)}finally{this.loading=!1}}}}),Fe=()=>H.get("/doctype_list"),te=I("doctypes",{state:()=>({doctypes:[],selectedDoctypes:null,loading:!1,error:null}),actions:{async fetchAll(){try{this.loading=!0;const e=await Fe();this.doctypes=e.data}catch(e){this.error=e,console.error("Doctypes olishda xato:",e)}finally{this.loading=!1}}}}),De=()=>H.get("/delivery_type_list"),le=I("delivery",{state:()=>({delivery:[],selectedDelivery:null,loading:!1,error:null}),actions:{async fetchAll(){try{this.loading=!0;const e=await De();this.delivery=e.data}catch(e){this.error=e,console.error("Delivery olishda xato:",e)}finally{this.loading=!1}}}}),Te=()=>H.get("/subject_list"),ae=I("subjects",{state:()=>({subjects:[],selectedSubject:null,loading:!1,error:null}),actions:{async fetchAll(){try{this.loading=!0;const e=await Te();this.subjects=e.data}catch(e){this.error=e,console.error("Organizations olishda xato:",e)}finally{this.loading=!1}}}}),Ce=()=>H.get("task_status_list"),oe=I("status",{state:()=>({status:[],selectedStatus:null,loading:!1,error:null}),actions:{async fetchAll(){try{this.loading=!0;const e=await Ce();this.status=e.data}catch(e){this.error=e,console.error("Status olishda xato:",e)}finally{this.loading=!1}}}}),de={__name:"DockFormFields",props:{model:{type:Object,required:!0},errors:{type:Object,default:()=>({})}},setup(e){const o=ee(),r=te(),a=le(),f=oe(),k=ae();return(u,c)=>{const p=V("USelect"),h=V("UInput"),w=V("UDatePicker"),q=V("UTextarea");return m(),g(P,null,[t(p,{modelValue:e.model.organization_id,"onUpdate:modelValue":c[0]||(c[0]=s=>e.model.organization_id=s),options:d(o).organizations,label:"Tashkilot",placeholder:"Tashkilotni tanlang","option-label":"name_oz","option-value":"id",loading:d(o).loading,error:e.errors?.organization_id},null,8,["modelValue","options","loading","error"]),t(p,{modelValue:e.model.doc_type_id,"onUpdate:modelValue":c[1]||(c[1]=s=>e.model.doc_type_id=s),options:d(r).doctypes,label:"Hujjat turi",placeholder:"Hujjat turini tanlang","option-label":"name_oz","option-value":"id",loading:d(r).loading,error:e.errors?.doc_type_id},null,8,["modelValue","options","loading","error"]),t(p,{modelValue:e.model.delivery_method_id,"onUpdate:modelValue":c[2]||(c[2]=s=>e.model.delivery_method_id=s),options:d(a).delivery,label:"Yetkazish usuli",placeholder:"Yetkazish usulini tanlang","option-label":"name_oz","option-value":"id",loading:d(a).loading,error:e.errors?.delivery_method_id},null,8,["modelValue","options","loading","error"]),t(p,{modelValue:e.model.subject_id,"onUpdate:modelValue":c[3]||(c[3]=s=>e.model.subject_id=s),options:d(k).subjects,label:"Mavzu",placeholder:"Mavzuni tanlang","option-label":"name_oz","option-value":"id",loading:d(k).loading,error:e.errors?.subject_id},null,8,["modelValue","options","loading","error"]),t(p,{modelValue:e.model.status_id,"onUpdate:modelValue":c[4]||(c[4]=s=>e.model.status_id=s),options:d(f).status,label:"Holati",placeholder:"Holatni tanlang","option-label":"name_oz","option-value":"id",loading:d(f).loading,error:e.errors?.status_id},null,8,["modelValue","options","loading","error"]),t(h,{modelValue:e.model.incoming_number,"onUpdate:modelValue":c[5]||(c[5]=s=>e.model.incoming_number=s),label:"Kiruvchi raqam",placeholder:"Kiruvchi raqamni kiriting",error:e.errors?.incoming_number},null,8,["modelValue","error"]),t(h,{modelValue:e.model.outgoing_number,"onUpdate:modelValue":c[6]||(c[6]=s=>e.model.outgoing_number=s),label:"Chiquvchi raqam",placeholder:"Chiquvchi raqamni kiriting",error:e.errors?.outgoing_number},null,8,["modelValue","error"]),t(h,{modelValue:e.model.document_name,"onUpdate:modelValue":c[7]||(c[7]=s=>e.model.document_name=s),label:"Hujjat nomi",placeholder:"Hujjat nomini kiriting",error:e.errors?.document_name},null,8,["modelValue","error"]),t(h,{modelValue:e.model.signed_by,"onUpdate:modelValue":c[8]||(c[8]=s=>e.model.signed_by=s),label:"Imzolovchi",placeholder:"Imzolovchini kiriting",error:e.errors?.signed_by},null,8,["modelValue","error"]),t(h,{modelValue:e.model.executor,"onUpdate:modelValue":c[9]||(c[9]=s=>e.model.executor=s),label:"Ijrochi",placeholder:"Ijrochini kiriting",error:e.errors?.executor},null,8,["modelValue","error"]),t(w,{modelValue:e.model.doc_date,"onUpdate:modelValue":c[10]||(c[10]=s=>e.model.doc_date=s),label:"Bajarish muddati",placeholder:"Sanani tanlang",error:e.errors?.doc_date},null,8,["modelValue","error"]),t(h,{modelValue:e.model.phone_number,"onUpdate:modelValue":c[11]||(c[11]=s=>e.model.phone_number=s),label:"Telefon raqami",placeholder:"+998 XX XXX XX XX",error:e.errors?.phone_number},null,8,["modelValue","error"]),t(q,{modelValue:e.model.short_content,"onUpdate:modelValue":c[12]||(c[12]=s=>e.model.short_content=s),label:"Qisqacha mazmun",placeholder:"Hujjatning qisqacha mazmunini kiriting",error:e.errors?.short_content},null,8,["modelValue","error"])],64)}}},He={class:"flex flex-col gap-2 w-full"},Ie={key:0,class:"text-md font-semibold text-dark"},Ae={class:"relative border-2 border-dashed rounded p-6 flex flex-col items-center justify-center cursor-pointer bg-white hover:bg-blue-50 dark:bg-zinc-700 dark:hover:bg-zinc-600 transition duration-200 shadow-sm hover:shadow-md"},Be={class:"flex flex-col items-center justify-center text-zinc-400 dark:text-zinc-300 transition-transform duration-150"},Me=["multiple","accept"],Pe={class:"mt-3 text-xs text-zinc-500 dark:text-zinc-400 select-none"},Le={key:1,class:"text-md text-red-500 italic py-2"},Xe={key:2,class:"space-y-2"},ue={__name:"UFileInput",props:{label:String,multiple:{type:Boolean,default:!1},accept:{type:String,default:""},modelValue:{type:Array,default:()=>[]},error:{type:String,default:""}},emits:["update:modelValue","change"],setup(e,{emit:o}){const r=e,a=o,f=U([...r.modelValue]),k=U(null);re(()=>r.modelValue,p=>{f.value=[...p]});const u=p=>{const h=Array.from(p.target.files);if(!h.length)return;const w=h.map(q=>Object.assign(q,{isLocal:!0}));f.value=r.multiple?[...f.value,...w]:w,a("update:modelValue",f.value),a("change",f.value),k.value.value=""},c=p=>{f.value=f.value.filter(h=>h!==p),a("update:modelValue",f.value)};return(p,h)=>(m(),g("div",He,[e.label?(m(),g("label",Ie,T(e.label),1)):C("",!0),l("div",Ae,[l("div",Be,[t(d(qe),{class:"w-14 h-14 mb-3"}),h[0]||(h[0]=l("p",{class:"text-sm text-zinc-700 dark:text-zinc-200 text-center leading-snug"},[D(" Faylni shu yerga "),l("span",{class:"text-blue-600 font-semibold"},"tortib keltiring"),D(),l("br"),D(" yoki "),l("span",{class:"text-blue-600 font-semibold"},"tanlang")],-1))]),l("input",{ref_key:"fileInput",ref:k,type:"file",class:"absolute inset-0 opacity-0 cursor-pointer",multiple:e.multiple,accept:e.accept,onChange:u},null,40,Me),l("p",Pe,T(e.multiple?"Bir nechta fayllarni tanlang yoki tashlang":"Faylni tanlang yoki tashlang"),1)]),e.error?(m(),g("p",Le,T(e.error),1)):C("",!0),f.value.length?(m(),g("div",Xe,[(m(!0),g(P,null,Y(f.value,w=>(m(),F(E,{key:w.name,file:w,"show-delete":!0,onRemove:c},null,8,["file"]))),128))])):C("",!0)]))}},Ye=(e,o)=>H.post(`file-upload?task_id=${o}`,e,{headers:{"Content-Type":"multipart/form-data"}}),ce=I("fileupload",{state:()=>({files:[],response:[],error:null}),actions:{setFiles(e){this.files=e},async upload(e){if(this.files.length){this.response=[],this.error=null;try{const o=new FormData;this.files.forEach(a=>{o.append("files[]",a)});const r=await Ye(o,e);return this.response=r.data||[],console.log(r.data),this.response}catch(o){throw this.error=o.response?.data||o.message||o,console.log(o.response?.data),this.error}}},clear(){this.files=[],this.response=[],this.error=null}}}),Ne=e=>H.post("/document_file_create",e),Oe=e=>H.delete(`/document_file_delete/${e}`),me=I("documentfilecreate",{state:()=>({response:null,error:null,loading:!1}),actions:{async createFiles(e,o){if(!(!e||!o?.length)){this.loading=!0,this.error=null;try{const r={incoming_documents_id:e,files:o.map(f=>({url:f.url,type:f.type||"main"}))},a=await Ne(r);return this.response=a.data,a.data}catch(r){throw this.error=r.response?.data||r.message,this.error}finally{this.loading=!1}}},async deleteFile(e){if(e){this.loading=!0,this.error=null;try{return(await Oe(e)).data}catch(o){throw this.error=o.response?.data||o.message,o}finally{this.loading=!1}}},clear(){this.response=null,this.error=null,this.loading=!1}}}),Ke={class:"w-[80vw] h-[85vh] flex flex-col"},Ee={class:"flex justify-between modal-border items-center p-4 border-b shadow-sm"},Qe={key:0,class:"flex flex-col h-full justify-center overflow-y-auto"},Re={key:1,class:"flex-1 overflow-y-auto px-6 py-10"},Je={class:"grid grid-cols-1 md:grid-cols-2 gap-3 flex-1"},We={class:"w-full lg:w-1/3 flex flex-col"},Ge={key:0,class:"mt-4 flex-1 flex flex-col"},Ze={class:"flex-1 overflow-y-auto space-y-2"},et={class:"flex modal-border justify-end gap-3 p-4 border-t"},tt={__name:"UpdateDockForm",props:{id:{type:Number,required:!0}},setup(e){const o=e,r=U([]),a=U([]),f=U(!0),k=G(),u=ce(),c=me(),p=R(),h=J(),w=ee(),q=te(),s=le(),i=ae(),j=oe(),{form:b,errors:S,validate:B,resetForm:A}=ne({organization_id:"",doc_type_id:"",doc_date:"",delivery_method_id:"",subject_id:"",incoming_number:"",outgoing_number:"",status_id:"",document_name:"",short_content:"",signed_by:"",executor:"",phone_number:"",files:[]},{organization_id:{required:!0,message:"Tashkilotni tanlang"},doc_type_id:{required:!0,message:"Hujjat turini tanlang"},delivery_method_id:{required:!0,message:"Yetkazish usulini tanlang"},subject_id:{required:!0,message:"Mavzu majburiy"},status_id:{required:!0,message:"Holatni tanlang"},incoming_number:{required:!0,message:"Kiruvchi raqam majburiy"},outgoing_number:{required:!0,message:"Chiquvchi raqam majburiy"},document_name:{required:!0,message:"Hujjat nomi majburiy"},short_content:{required:!0,message:"Qisqacha mazmun majburiy"},signed_by:{required:!0,message:"Imzolovchini kiriting"},executor:{required:!0,message:"Ijrochini kiriting"},phone_number:{required:!0,message:"Telefon raqamini kiriting"},doc_date:{required:!0,message:"Sanani tanlang"}}),x=()=>r.value.length===0&&b.files.length===0?(S.files="Asos hujjatni yuklang !",!1):(S.files="",!0),L=n=>{n.id?(a.value.push(n.id),r.value=r.value.filter(_=>_.id!==n.id)):n instanceof File&&(b.files=b.files.filter(_=>_!==n))};W(async()=>{await Promise.all([w.fetchAll(),q.fetchAll(),s.fetchAll(),i.fetchAll(),j.fetchAll()]);const n=await k.fetchDock(o.id);Object.assign(b,{organization_id:n.organization_id,doc_type_id:n.doc_type_id,delivery_method_id:n.delivery_method_id,subject_id:n.subject_id,status_id:n.status_id,incoming_number:n.incoming_number,outgoing_number:n.outgoing_number,document_name:n.document_name,short_content:n.short_content,signed_by:n.signed_by,executor:n.executor,phone_number:n.phone_number,doc_date:n.doc_date,files:[]}),r.value=n.files||[],f.value=!1});const M=async n=>{b.files.length&&(u.files=[...b.files],await u.upload(n),u.response?.length&&await c.createFiles(n,u.response))},X=async()=>{const n=B(),_=x();if(!n||!_){h.show("Iltimos, formani to‘liq to‘ldiring !","error");return}try{await k.createDock(o.id,b);for(const z of a.value)await c.deleteFile(z);a.value=[],await M(o.id),await k.fetchAll(),v(),h.show("Hujjat muvaffaqiyatli yangilandi !","success")}catch(z){console.error(z),h.show("Hujjatni yangilashda xatolik !","error")}},v=()=>{A(),u.clear(),p.close()};return(n,_)=>{const z=V("UButton"),fe=V("ULoadingspin");return m(),g("div",Ke,[l("div",Ee,[_[1]||(_[1]=l("p",{class:"text-dark text-lg font-semibold"},"Hujjatni tahrirlash",-1)),t(z,{variant:"hover",onClick:v},{default:y(()=>[t(d(Z),{class:"w-5 h-5"})]),_:1})]),f.value?(m(),g("div",Qe,[t(fe,{size:"md"})])):(m(),g("div",Re,[l("form",{onSubmit:K(X,["prevent"]),class:"flex flex-col lg:flex-row gap-6 h-full"},[l("div",Je,[t(de,{model:d(b),errors:d(S)},null,8,["model","errors"])]),l("div",We,[t(ue,{modelValue:d(b).files,"onUpdate:modelValue":_[0]||(_[0]=O=>d(b).files=O),label:"Hujjat yuklash (asosiy faylni birnchi yuklang)",multiple:"",accept:".pdf,.docx,.jpg,.png",error:d(S).files},null,8,["modelValue","error"]),r.value.length?(m(),g("div",Ge,[l("div",Ze,[(m(!0),g(P,null,Y(r.value,O=>(m(),F(E,{key:O.id,file:O,"show-delete":!0,onRemove:L},null,8,["file"]))),128))])])):C("",!0)])],32),_[2]||(_[2]=l("div",{class:"h-20"},null,-1))])),l("div",et,[t(z,{onClick:v},{default:y(()=>[..._[3]||(_[3]=[D("Bekor qilish",-1)])]),_:1}),t(z,{variant:"primary",onClick:X,loading:d(k).loading},{default:y(()=>[..._[4]||(_[4]=[D(" Yangilash va yuborish ",-1)])]),_:1},8,["loading"])])])}}},lt=e=>H.post("/incoming_document_draft",e),at=I("draftDock",{state:()=>({data:null,loading:!1,error:null}),actions:{async createDraft(e){this.loading=!0,this.error=null;try{const o=await lt(e);return this.data=o.data,console.log(o.data),o}catch(o){throw this.error=o.message,console.error(o),o}finally{this.loading=!1}}}}),ot={class:"w-[80vw] h-[85vh] flex flex-col"},st={class:"flex justify-between modal-border items-center p-4 border-b shadow-sm"},rt={class:"overflow-y-auto px-6 py-10 flex-1"},it={class:"grid grid-cols-1 md:grid-cols-2 gap-3 flex-1"},nt={class:"w-full lg:w-1/3 flex flex-col"},dt={key:0,class:"mt-4 flex-1 flex flex-col"},ut={class:"flex-1 overflow-y-auto space-y-2"},ct={class:"flex justify-end gap-3 p-4 border-t modal-border"},mt={__name:"CreateDockForm",setup(e){const o=at(),r=G(),a=ce(),f=me(),k=R(),u=J(),c=ee(),p=te(),h=le(),w=ae(),q=oe(),{form:s,errors:i,validate:j,resetForm:b}=ne({organization_id:"",doc_type_id:"",doc_date:"",delivery_method_id:"",subject_id:"",incoming_number:"",status_id:"",document_name:"",short_content:"",signed_by:"",executor:"",phone_number:"",files:[]},{organization_id:{required:!0,message:"Tashkilotni tanlang"},doc_type_id:{required:!0,message:"Hujjat turini tanlang"},delivery_method_id:{required:!0,message:"Yetkazish usulini tanlang"},subject_id:{required:!0,message:"Mavzuni tanlang"},status_id:{required:!0,message:"Statusni tanlang"},incoming_number:{required:!0,message:"Kiruvchi raqamni kiriting"},outgoing_number:{required:!0,message:"Chiquvchi raqamni kiriting"},document_name:{required:!0,message:"Hujjat nomi majburiy"},short_content:{required:!0,message:"Qisqacha mazmun majburiy"},signed_by:{required:!0,message:"Imzolovchi majburiy"},executor:{required:!0,message:"Ijrochi majburiy"},phone_number:{required:!0,message:"Telefon raqami majburiy"},doc_date:{required:!0,message:"Sanani tanlang"},files:{required:!0,message:"Asos hujjatni yuklang !"}}),S=U(null),B=U(null),A=U([]);W(async()=>{try{await Promise.all([c.fetchAll(),p.fetchAll(),h.fetchAll(),w.fetchAll(),q.fetchAll()]);const v=localStorage.getItem("user");if(v&&(B.value=JSON.parse(v).id),B.value){const{data:n}=await o.createDraft({user_id:B.value});S.value=n?.incoming_document_create_id,u.show(`Hujjat (ID: ${S.value}) muvaffaqiyatli yaratildi!`,"success")}}catch(v){console.error("CreateDockForm onMounted error:",v),u.show("Hujjat yaratishda xatolik yuz berdi!","error")}});const x=async v=>{if(v.id)try{await f.deleteFile(v.id),A.value=A.value.filter(n=>n.id!==v.id)}catch{alert("Fayl o‘chirishda xatolik!")}else v instanceof File&&(s.files=s.files.filter(n=>n!==v))},L=async v=>{!v||!s.files.length||(a.files=[...s.files],await a.upload(v),a.response?.length&&await f.createFiles(v,a.response))},M=async()=>{if(!j()){u.show("Iltimos, formani to‘ldiring !","error");return}if(S.value)try{await r.createDock(S.value,s),await L(S.value),X(),u.show("Hujjat muvaffaqiyatli saqlandi va yuborildi!","success")}catch(v){console.error("handleSubmit error:",v),u.show("Hujjatni saqlashda xatolik yuz berdi!","error")}},X=()=>{b(),a.clear(),k.close()};return(v,n)=>{const _=V("UButton");return m(),g("div",ot,[l("div",st,[n[1]||(n[1]=l("p",{class:"text-dark text-lg font-semibold"},"Hujjat yaratish",-1)),t(_,{variant:"hover",onClick:X},{default:y(()=>[t(d(Z),{class:"w-5 h-5"})]),_:1})]),l("div",rt,[l("form",{onSubmit:K(M,["prevent"]),class:"flex flex-col lg:flex-row gap-6 h-full"},[l("div",it,[t(de,{model:d(s),errors:d(i)},null,8,["model","errors"])]),l("div",nt,[t(ue,{modelValue:d(s).files,"onUpdate:modelValue":n[0]||(n[0]=z=>d(s).files=z),label:"Hujjat yuklash (asosiy faylni birnchi yuklang)",multiple:"",accept:".pdf,.docx,.jpg,.png",error:d(i).files},null,8,["modelValue","error"]),A.value.length?(m(),g("div",dt,[l("div",ut,[(m(!0),g(P,null,Y(A.value,z=>(m(),F(E,{key:z.id,file:z,"show-delete":!0,onRemove:x},null,8,["file"]))),128))])])):C("",!0)])],32),n[2]||(n[2]=l("div",{class:"h-20"},null,-1))]),l("div",ct,[t(_,{onClick:X},{default:y(()=>[...n[3]||(n[3]=[D("Bekor qilish",-1)])]),_:1}),t(_,{variant:"primary",onClick:M,loading:d(r).loading},{default:y(()=>[...n[4]||(n[4]=[D(" Saqlash va yuborish ",-1)])]),_:1},8,["loading"])])])}}},ft={class:"flex flex-col md:flex-row md:items-start justify-between gap-4 md:gap-6"},ht={class:"flex-1 min-w-0"},gt={class:"text-xl font-semibold text-zinc-800 dark:text-white/90"},vt={class:"flex flex-col gap-1 font-medium text-md"},yt={class:"flex-1 min-w-0 truncate"},pt={class:"flex gap-1"},bt={class:"card-dark mt-2 inline-flex rounded-full border px-2 py-0.5 text-md font-semibold truncate max-w-full"},_t={class:"card-dark mt-2 inline-flex rounded-full border px-2 py-0.5 text-md font-semibold truncate max-w-full"},kt={class:"card-dark mt-2 inline-flex rounded-full border px-2 py-0.5 text-md font-semibold truncate max-w-full"},xt={class:"card-dark mt-2 inline-flex vf rounded-full border px-2 py-0.5 text-md font-semibold truncate max-w-full"},wt={class:"flex-shrink-0 mt-2 md:mt-0"},jt="task card-dark border-b px-3 py-4 cursor-pointer hover:bg-blue-100 dark:hover:bg-zinc-600/50",St={__name:"DockListItem",props:{dock:{type:Object,required:!0},active:{type:Boolean,default:!1}},setup(e){return(o,r)=>{const a=V("UTooltip");return m(),g("div",{onClick:r[0]||(r[0]=f=>o.$emit("select",e.dock)),class:ie([jt,e.active?"bg-blue-100":""])},[l("div",ft,[l("div",ht,[l("h4",gt,"SSV-"+T(e.dock.id)+"/05",1),l("div",vt,[l("span",yt,[r[1]||(r[1]=l("span",{class:"font-semibold whitespace-nowrap"},"Mazmun:",-1)),D(" "+T(e.dock.short_content?.slice(0,200))+T((e.dock.short_content?.length??0)>50?"...":""),1)])]),l("div",pt,[t(a,{text:"Ijrochi",position:"bottom"},{default:y(()=>[l("span",bt,T(e.dock.executor),1)]),_:1}),t(a,{text:"Kirish raqami",position:"bottom"},{default:y(()=>[l("span",_t,T(e.dock.incoming_number),1)]),_:1}),t(a,{text:"Chiqish raqami",position:"bottom"},{default:y(()=>[l("span",kt,T(e.dock.outgoing_number),1)]),_:1}),t(a,{text:"Yaratilgan sana",position:"bottom"},{default:y(()=>[l("span",xt,T(e.dock.doc_date?d(he)(e.dock.doc_date).format("YYYY-MM-DD"):""),1)]),_:1})])]),l("div",wt,[t(a,{text:"Ijro holatida",position:"top"},{default:y(()=>[t(d(ge),{class:"w-5 h-5 text-blue-500"})]),_:1})])])],2)}}},Vt={key:0},qt={class:"grid grid-cols-1 md:grid-cols-2 gap-4 pb-4"},zt={key:0},$t={class:"space-y-2"},Ut={__name:"DockShowItem",props:{dockfile:{type:Object,default:null}},setup(e){return(o,r)=>e.dockfile?(m(),g("div",Vt,[l("div",qt,[t($,{label:"Kelib tushgan raqam",value:e.dockfile.incoming_number},null,8,["value"]),t($,{label:"Chiqish raqami",value:e.dockfile.outgoing_number},null,8,["value"]),t($,{label:"Hujjat nomi",value:e.dockfile.document_name,class:"md:col-span-2"},null,8,["value"]),t($,{label:"Ijrochi",value:e.dockfile.executor},null,8,["value"]),t($,{label:"Telefon raqam",value:e.dockfile.phone_number},null,8,["value"]),t($,{label:"Holati",value:e.dockfile.status_id},null,8,["value"]),t($,{label:"Qisqa mazmun",value:e.dockfile.short_content,class:"md:col-span-2"},null,8,["value"]),t($,{label:"Tashkilot",value:e.dockfile.organization_name_oz},null,8,["value"]),t($,{label:"Hujjat turi",value:e.dockfile.doc_type_name_oz},null,8,["value"]),t($,{label:"Yetkazib berish usuli",value:e.dockfile.delivery_methods_name_oz},null,8,["value"]),t($,{label:"Masala turi",value:e.dockfile.issue_type_name_oz},null,8,["value"]),t($,{label:"Bajarish muddate",value:e.dockfile.doc_date},null,8,["value"])]),e.dockfile.files?.length?(m(),g("div",zt,[r[0]||(r[0]=l("h3",{class:"font-semibold mb-2"},"Fayllar:",-1)),l("div",$t,[(m(!0),g(P,null,Y(e.dockfile.files,a=>(m(),F(E,{key:a.id,file:a},null,8,["file"]))),128))])])):C("",!0)])):(m(),F(ve,{key:1}))}},Ft=()=>H.post("/task_create"),Dt=I("task",{state:()=>({tasks:[],selectedTask:null,loading:!1,error:null}),actions:{async createTask(e={}){const o=J();this.loading=!0,this.error=null;try{const r=await Ft(e);if(r?.data?.success){const a=r.data.task;return a&&this.tasks.push(a),o.success(r.data.message||"Task muvaffaqiyatli yaratildi!"),console.log("Task created:",a),a}else{const a=r?.data?.message||"Noma'lum xatolik";this.error=a,o.error(a)}}catch(r){const a=r?.response?.data?.message||r.message||"Server xatosi";this.error=a,o.error(a),console.error("createTask error:",r)}finally{this.loading=!1}},setSelectedTask(e){this.selectedTask=e}}}),Tt={class:"w-[40vw] h-[85vh] flex flex-col bg-white rounded-xl shadow-lg"},Ct={class:"flex justify-between items-center p-4 border-b"},Ht={class:"p-6 overflow-y-auto h-[85vh] space-y-6"},It={class:"col-span-full space-y-3"},At={class:"flex justify-between items-center mb-2"},Bt={class:"flex justify-end gap-3 p-4 border-t"},Mt={__name:"CreateTaskForm",props:{id:{type:Number,required:!0}},setup(e){const o=R(),r=Dt(),a=we(),f=J(),u=U({incoming_documents_id:e.id,item_number:null,task_type_id:null,deadline_start:"",deadline_end:"",description:"",executor:[{user_id:null}]}),c=ke(()=>a.users||[]);W(async()=>{await a.fetchUsers(),console.log("Users:",a.users)});const p=()=>{u.value.executor.push({user_id:null})},h=s=>u.value.executor.splice(s,1),w=()=>o.close(),q=async()=>{if(!u.value.incoming_documents_id||!u.value.task_type_id){f.show({type:"error",message:"Hujjat ID va Task turi majburiy"});return}const s={...u.value,deadline_start:u.value.deadline_start.replace("T"," "),deadline_end:u.value.deadline_end.replace("T"," ")};try{await r.createTask(s)?(o.close(),f.show({type:"success",message:"Topshiriq muvaffaqiyatli yaratildi"})):f.show({type:"error",message:r.error||"Xatolik yuz berdi"})}catch(i){f.show({type:"error",message:i.message||"Server xatosi"})}};return(s,i)=>{const j=V("UButton"),b=V("UInput"),S=V("UDatePicker"),B=V("UTextarea"),A=V("USelect");return m(),g("div",Tt,[l("div",Ct,[i[6]||(i[6]=l("h2",{class:"text-xl font-bold text-gray-800"},"Topshiriq yaratish",-1)),t(j,{variant:"hover",size:"sm",onClick:w},{default:y(()=>[t(d(Z),{class:"w-5 h-5"})]),_:1})]),l("div",Ht,[l("form",{onSubmit:K(q,["prevent"]),class:"grid grid-cols-1 lg:grid-cols-2 gap-4"},[t(b,{modelValue:u.value.incoming_documents_id,"onUpdate:modelValue":i[0]||(i[0]=x=>u.value.incoming_documents_id=x),label:"Hujjat ID",type:"number"},null,8,["modelValue"]),t(b,{modelValue:u.value.item_number,"onUpdate:modelValue":i[1]||(i[1]=x=>u.value.item_number=x),label:"Punkt raqami",type:"number"},null,8,["modelValue"]),t(b,{modelValue:u.value.task_type_id,"onUpdate:modelValue":i[2]||(i[2]=x=>u.value.task_type_id=x),label:"Task turi ID",type:"number"},null,8,["modelValue"]),t(S,{modelValue:u.value.deadline_start,"onUpdate:modelValue":i[3]||(i[3]=x=>u.value.deadline_start=x),label:"Boshlanish vaqti",type:"datetime-local"},null,8,["modelValue"]),t(S,{modelValue:u.value.deadline_end,"onUpdate:modelValue":i[4]||(i[4]=x=>u.value.deadline_end=x),label:"Tugash vaqti",type:"datetime-local"},null,8,["modelValue"]),t(B,{modelValue:u.value.description,"onUpdate:modelValue":i[5]||(i[5]=x=>u.value.description=x),label:"Izoh",rows:"4",class:"col-span-full"},null,8,["modelValue"]),l("div",It,[l("div",At,[i[8]||(i[8]=l("h3",{class:"font-semibold text-gray-700"},"Ijrochilar",-1)),t(j,{variant:"outline",size:"xs",onClick:p},{default:y(()=>[t(d(ze),{class:"w-4 h-4"}),i[7]||(i[7]=D(" Qo‘shish ",-1))]),_:1})]),(m(!0),g(P,null,Y(u.value.executor,(x,L)=>(m(),g("div",{key:L,class:"grid grid-cols-1 md:grid-cols-2 gap-3 border p-3 rounded-lg relative"},[t(A,{modelValue:x.user_id,"onUpdate:modelValue":M=>x.user_id=M,options:c.value,"option-label":"firstname","option-value":"id",placeholder:"Foydalanuvchini tanlang"},null,8,["modelValue","onUpdate:modelValue","options"]),u.value.executor.length>1?(m(),F(j,{key:0,variant:"hover",class:"absolute top-3 right-3",onClick:K(M=>h(L),["prevent"])},{default:y(()=>[t(d(ye),{class:"w-4 h-4 text-red-500"})]),_:1},8,["onClick"])):C("",!0)]))),128))])],32)]),l("div",Bt,[t(j,{onClick:w},{default:y(()=>[...i[9]||(i[9]=[D("Bekor qilish",-1)])]),_:1}),t(j,{type:"submit",variant:"primary",onClick:q},{default:y(()=>[...i[10]||(i[10]=[D("Saqlash va yuborish",-1)])]),_:1})])])}}},Pt={class:"mx-auto"},Lt={class:"w-full card-dark flex items-center justify-between rounded px-2"},Xt={class:"grid grid-cols-1 lg:grid-cols-12"},Yt={class:"card-dark border"},Nt={class:"flex px-1 py-4 items-center border-b card-border justify-between"},Ot={class:"flex gap-1"},Kt={class:"h-[calc(100vh-8rem)] overflow-y-auto"},Et={key:0,class:"lg:col-span-5 2xl:col-span-5 pb-10 space-y-2"},Qt={class:"card-dark border"},Rt={class:"flex px-1 py-4 items-center border-b card-border justify-between"},Jt={class:"h-[calc(100vh-8rem)] overflow-y-auto"},al={__name:"TransmittedViews",setup(e){const o=G(),r=R(),a=U(null),f=U(null),k=U(!0),u=s=>o.fetchAll(s);function c(){r.open(mt)}function p(){a.value&&r.open(Mt,{id:a.value.id})}function h(){a.value&&r.open(tt,{id:a.value.id})}function w(){k.value=!k.value}function q(s){f.value=s.id,a.value=s}return re(()=>o.docks,s=>{if(a.value){const i=s.find(j=>j.id===a.value.id);i&&(a.value=i)}},{deep:!0}),W(async()=>{await o.fetchAll()}),(s,i)=>{const j=xe("wave");return m(),g("div",Pt,[l("div",Lt,[t(pe),t(N,{onClick:c,variant:"primary"},{default:y(()=>[t(d(Ve),{class:"w-5 h-5"}),i[0]||(i[0]=l("span",{class:"px-1"},"Hujjat yaratish",-1))]),_:1})]),l("div",Xt,[l("div",{class:ie(k.value?"lg:col-span-7 2xl:col-span-7":"lg:col-span-12 2xl:col-span-12")},[l("div",Yt,[l("div",Nt,[i[1]||(i[1]=l("h2",{class:"text-lg p-2 font-semibold text-dark"},"Topshiriqlar",-1)),l("div",Ot,[se((m(),F(N,{variant:"hover"},{default:y(()=>[t(d(be),{"stroke-width":1,class:"w-6 h-6"})]),_:1})),[[j]]),se((m(),F(N,{variant:"hover",onClick:w},{default:y(()=>[t(d(_e),{"stroke-width":1,class:"w-6 h-6"})]),_:1})),[[j]])])]),l("div",Kt,[(m(!0),g(P,null,Y(d(o).docks,b=>(m(),F(St,{key:b.id,dock:b,active:f.value===b.id,onSelect:q},null,8,["dock","active"]))),128)),t(Se,{total:d(o).pagination.total,currentPage:d(o).pagination.current_page,lastPage:d(o).pagination.last_page,onChange:u},null,8,["total","currentPage","lastPage"]),i[2]||(i[2]=l("div",{class:"h-24 w-full"},null,-1))])])],2),k.value?(m(),g("div",Et,[l("div",Qt,[l("div",Rt,[i[3]||(i[3]=l("h2",{class:"text-lg p-2 font-semibold text-dark"},"Hujjat",-1)),l("div",null,[a.value?(m(),F(N,{key:0,onClick:p,variant:"hover"},{default:y(()=>[t(d($e),{"stroke-width":1,class:"w-6 h-6"})]),_:1})):C("",!0),a.value?(m(),F(N,{key:1,onClick:h,variant:"hover"},{default:y(()=>[t(d(je),{"stroke-width":1,class:"w-6 h-6"})]),_:1})):C("",!0)])]),l("div",Jt,[t(Ut,{dockfile:a.value,class:"p-2"},null,8,["dockfile"]),i[4]||(i[4]=l("div",{class:"h-24 w-full"},null,-1))])])])):C("",!0)])])}}};export{al as default};
