import{d as te}from"./dayjs.min-Cg4NN4d1.js";import{O as le,J as Q,a as _,o as n,b as t,f as d,v as D,g as l,q as X,d as q,p as T,F as B,x as A,c as j,G as K,u as R,l as L,r as F,h as x,w as H,j as C,C as se,t as oe,P as N,s as ae}from"./index-m9snDiDH.js";import{H as ie,u as ne,S as re,_ as ue}from"./taskStore-CdyPvgyK.js";import{d as G,u as de,a as ce,b as me,_ as ve,c as fe,T as pe}from"./documentfilecreateStore-D7OOFrHW.js";import{u as _e,X as J,P as O}from"./useFormValidate-BonXcG65.js";import{u as W}from"./dockStore-C6Aj-C2T.js";import{u as ge}from"./OrganizationForm-CyVKB97Q.js";import{u as be}from"./doctypeStore-OJkowOX_.js";import{u as he}from"./deliveryStore-CSQm_Ra5.js";import{u as ye}from"./subjectStore-7JCAFQtX.js";import{u as xe}from"./usersStore-B8L_Nz5n.js";import{_ as ke}from"./UPagination-BZpHZZNW.js";import"./trash-2-BvdWlrNA.js";import"./chevron-right-HP1YvwTO.js";const we={class:"flex flex-row"},je={class:"flex-1 min-w-0"},$e={class:"flex items-center justify-between"},Se={class:"flex flex-col py-2"},qe={class:"flex items-center justify-between"},Ve={class:"flex-1 min-w-0 py-1 text-sm font-medium text-[#697696] line-clamp-2"},Fe="task card-dark border-b px-3 py-4 cursor-pointer hover:bg-[#4076FF0D]",Ce={__name:"DockListItem",props:{dock:{type:Object,required:!0},active:{type:Boolean,default:!1}},setup(s){const r=le(),u=(y,e)=>{r.open(y,{x:e.clientX+10,y:e.clientY+10})},o=s,g=Q(()=>te(o.dock.doc_date).format("DD MMM YYYY"));return(y,e)=>(n(),_("div",{onClick:e[6]||(e[6]=m=>y.$emit("select",s.dock)),class:X([Fe,s.active?"bg-[#4076FF0D]":""])},[t("div",we,[t("div",je,[t("div",$e,[t("h4",{onMouseenter:e[0]||(e[0]=m=>u("Kiruvchi raqam",m)),onMouseleave:e[1]||(e[1]=m=>d(r).close()),class:"text-sm font-extrabold text-black"},D(s.dock.incoming_number),33),t("h4",{onMouseenter:e[2]||(e[2]=m=>u("Ro`yxarga olingan sana",m)),onMouseleave:e[3]||(e[3]=m=>d(r).close()),class:"text-sm font-medium text-[#697696]"},D(g.value),33)]),t("div",Se,[t("div",qe,[e[7]||(e[7]=t("span",{class:"flex-1 min-w-0 truncate text-sm font-bold text-black"}," Kiruvchi hujjat ",-1)),l(d(ie),{onMouseenter:e[4]||(e[4]=m=>u("Ijrochi biriktirlmagan",m)),onMouseleave:e[5]||(e[5]=m=>d(r).close()),class:"w-5 h-5 text-blue-500"})]),t("span",Ve,D(s.dock.short_content),1)])])])],2))}},Te={class:"text-[#697696] text-md font-medium"},Ue={class:"text-dark text-lg font-bold"},h={__name:"UInfoItem",props:{label:String,value:[String,Number]},setup(s){const r=q(!1);return(u,o)=>(n(),_("div",{class:X([u.$attrs.class,"relative cursor-pointer"]),onMouseenter:o[0]||(o[0]=g=>r.value=!0),onMouseleave:o[1]||(o[1]=g=>r.value=!1)},[t("p",Te,D(s.label),1),t("p",Ue,D(s.value),1)],34))}},De={key:0},ze={class:"grid grid-cols-1 md:grid-cols-2 gap-4 pb-4"},Ie={key:0},Me={class:"grid grid-cols-2 gap-2"},He={__name:"DockShowItem",props:{dockfile:{type:Object,default:null}},setup(s){return(r,u)=>s.dockfile?(n(),_("div",De,[t("div",ze,[l(h,{label:"Kelib tushgan raqam",value:s.dockfile.incoming_number},null,8,["value"]),l(h,{label:"Chiqish raqami",value:s.dockfile.outgoing_number},null,8,["value"]),l(h,{label:"Hujjat nomi",value:s.dockfile.document_name,class:"md:col-span-2"},null,8,["value"]),l(h,{label:"Ijrochi",value:s.dockfile.executor},null,8,["value"]),l(h,{label:"Telefon raqam",value:s.dockfile.phone_number},null,8,["value"]),l(h,{label:"Holati",value:s.dockfile.status_id},null,8,["value"]),l(h,{label:"Qisqa mazmun",value:s.dockfile.short_content,class:"md:col-span-2"},null,8,["value"]),l(h,{label:"Tashkilot",value:s.dockfile.organization_name_oz},null,8,["value"]),l(h,{label:"Hujjat turi",value:s.dockfile.doc_type_name_oz},null,8,["value"]),l(h,{label:"Yetkazib berish usuli",value:s.dockfile.delivery_methods_name_oz},null,8,["value"]),l(h,{label:"Masala turi",value:s.dockfile.issue_type_name_oz},null,8,["value"]),l(h,{label:"Bajarish muddate",value:s.dockfile.doc_date},null,8,["value"])]),s.dockfile.files?.length?(n(),_("div",Ie,[u[0]||(u[0]=t("h3",{class:"font-semibold mb-2"},"Fayllar:",-1)),t("div",Me,[(n(!0),_(B,null,A(s.dockfile.files,o=>(n(),j(G,{key:o.id,file:o},null,8,["file"]))),128))])])):T("",!0)])):T("",!0)}},Be={class:"w-[100vw] md:w-[90vw] 2xl:w-[70vw] h-[95vh] flex flex-col"},Ae={class:"flex justify-between modal-border items-center p-4 border-b shadow-sm"},Pe={key:0,class:"flex flex-col h-full justify-center overflow-y-auto"},Ye={key:1,class:"flex-1 overflow-y-auto px-6 py-10"},Ne={class:"w-full flex flex-col py-[16px]"},Ke={key:0,class:"mt-4 flex-1 flex flex-col"},Le={class:"flex-1 overflow-y-auto space-y-2"},Ee={class:"flex modal-border justify-end gap-3 p-4 border-t"},Qe={__name:"UpdateDockForm",props:{id:{type:Number,required:!0}},setup(s){const r=s,u=q([]),o=q([]),g=q(!0),y=W(),e=de(),m=ce(),U=K(),b=R(),c=ge(),w=be(),k=he(),a=ye(),$=me(),{form:v,errors:V,validate:P,resetForm:f}=_e({organization_id:"",doc_type_id:"",doc_date:"",delivery_method_id:"",subject_id:"",incoming_number:"",outgoing_number:"",status_id:"",document_name:"",short_content:"",signed_by:"",executor:"",phone_number:"",files:[]},{organization_id:{required:!0,message:"Tashkilotni tanlang"},doc_type_id:{required:!0,message:"Hujjat turini tanlang"},delivery_method_id:{required:!0,message:"Yetkazish usulini tanlang"},subject_id:{required:!0,message:"Mavzu majburiy"},status_id:{required:!0,message:"Holatni tanlang"},incoming_number:{required:!0,message:"Kiruvchi raqam majburiy"},outgoing_number:{required:!0,message:"Chiquvchi raqam majburiy"},document_name:{required:!0,message:"Hujjat nomi majburiy"},short_content:{required:!0,message:"Qisqacha mazmun majburiy"},signed_by:{required:!0,message:"Imzolovchini kiriting"},executor:{required:!0,message:"Ijrochini kiriting"},phone_number:{required:!0,message:"Telefon raqamini kiriting"},doc_date:{required:!0,message:"Sanani tanlang"}}),z=()=>u.value.length===0&&v.files.length===0?(V.files="Asos hujjatni yuklang !",!1):(V.files="",!0),I=i=>{i.id?(o.value.push(i.id),u.value=u.value.filter(p=>p.id!==i.id)):i instanceof File&&(v.files=v.files.filter(p=>p!==i))};L(async()=>{await Promise.all([c.fetchAll(),w.fetchAll(),k.fetchAll(),a.fetchAll(),$.fetchAll()]);const i=await y.fetchDock(r.id);Object.assign(v,{organization_id:i.organization_id,doc_type_id:i.doc_type_id,delivery_method_id:i.delivery_method_id,subject_id:i.subject_id,status_id:i.status_id,incoming_number:i.incoming_number,outgoing_number:i.outgoing_number,document_name:i.document_name,short_content:i.short_content,signed_by:i.signed_by,executor:i.executor,phone_number:i.phone_number,doc_date:i.doc_date,files:[]}),u.value=i.files||[],g.value=!1});const Z=async i=>{v.files.length&&(e.files=[...v.files],await e.upload(i),e.response?.length&&await m.createFiles(i,e.response))},E=async()=>{const i=P(),p=z();if(!i||!p){b.show("Iltimos, formani to‘liq to‘ldiring !","error");return}try{await y.createDock(r.id,v);for(const S of o.value)await m.deleteFile(S);o.value=[],await Z(r.id),await y.fetchAll(),Y(),b.show("Hujjat muvaffaqiyatli yangilandi !","success")}catch(S){console.error(S),b.show("Hujjatni yangilashda xatolik !","error")}},Y=()=>{f(),e.clear(),U.close()};return(i,p)=>{const S=F("UButton"),ee=F("ULoadingspin");return n(),_("div",Be,[t("div",Ae,[p[1]||(p[1]=t("p",{class:"text-dark text-lg font-semibold"},"Hujjatni tahrirlash",-1)),l(S,{variant:"hover",onClick:Y},{default:x(()=>[l(d(J),{class:"w-5 h-5"})]),_:1})]),g.value?(n(),_("div",Pe,[l(ee,{size:"md"})])):(n(),_("div",Ye,[t("form",{onSubmit:H(E,["prevent"]),class:"flex flex-col h-full"},[l(ve,{model:d(v),errors:d(V)},null,8,["model","errors"]),t("div",Ne,[l(fe,{modelValue:d(v).files,"onUpdate:modelValue":p[0]||(p[0]=M=>d(v).files=M),label:"Hujjat yuklash (asosiy faylni birnchi yuklang)",multiple:"",accept:".pdf,.docx,.jpg,.png",error:d(V).files},null,8,["modelValue","error"]),u.value.length?(n(),_("div",Ke,[t("div",Le,[(n(!0),_(B,null,A(u.value,M=>(n(),j(G,{key:M.id,file:M,"show-delete":!0,onRemove:I},null,8,["file"]))),128))])])):T("",!0)])],32),p[2]||(p[2]=t("div",{class:"h-20"},null,-1))])),t("div",Ee,[l(S,{variant:"ghost",onClick:Y},{default:x(()=>[...p[3]||(p[3]=[C("Bekor qilish",-1)])]),_:1}),l(S,{variant:"primary",onClick:E,loading:d(y).loading},{default:x(()=>[...p[4]||(p[4]=[C(" Yangilash va yuborish ",-1)])]),_:1},8,["loading"])])])}}},Xe={class:"w-[40vw] h-[85vh] flex flex-col bg-white rounded-xl shadow-lg"},Re={class:"flex justify-between items-center p-4 border-b"},Ge={class:"p-6 overflow-y-auto h-[85vh] space-y-6"},Je={class:"col-span-full space-y-3"},Oe={class:"flex justify-between items-center mb-2"},We={class:"flex justify-end gap-3 p-4 border-t"},Ze={__name:"CreateTaskForm",props:{id:{type:Number,required:!0}},setup(s){const r=K(),u=ne(),o=xe(),g=R(),e=q({incoming_documents_id:s.id,item_number:null,task_type_id:null,deadline_start:"",deadline_end:"",description:"",executor:[{user_id:null}]}),m=Q(()=>o.users||[]);L(async()=>{await o.fetchUsers()});const U=()=>{e.value.executor.push({user_id:null})},b=k=>{e.value.executor.length>1&&e.value.executor.splice(k,1)},c=()=>r.close(),w=async()=>{if(!e.value.incoming_documents_id||!e.value.task_type_id){g.show({type:"error",message:"Hujjat ID va Task turi majburiy"});return}const k={...e.value,deadline_start:e.value.deadline_start.replace("T"," "),deadline_end:e.value.deadline_end.replace("T"," ")};try{await u.createTask(k)?(c(),g.show({type:"success",message:"Topshiriq muvaffaqiyatli yaratildi"})):g.show({type:"error",message:u.error||"Xatolik yuz berdi"})}catch(a){g.show({type:"error",message:a.message||"Server xatosi"})}};return(k,a)=>{const $=F("UButton"),v=F("UInput"),V=F("UTextarea"),P=F("USelect");return n(),_("div",Xe,[t("div",Re,[a[6]||(a[6]=t("h2",{class:"text-xl font-bold text-gray-800"},"Topshiriq yaratish",-1)),l($,{variant:"hover",size:"sm",onClick:c},{default:x(()=>[l(d(J),{class:"w-5 h-5"})]),_:1})]),t("div",Ge,[t("form",{onSubmit:H(w,["prevent"]),class:"grid grid-cols-1 lg:grid-cols-2 gap-4"},[l(v,{modelValue:e.value.incoming_documents_id,"onUpdate:modelValue":a[0]||(a[0]=f=>e.value.incoming_documents_id=f),label:"Hujjat ID",type:"number"},null,8,["modelValue"]),l(v,{modelValue:e.value.item_number,"onUpdate:modelValue":a[1]||(a[1]=f=>e.value.item_number=f),label:"Punkt raqami",type:"number"},null,8,["modelValue"]),l(v,{modelValue:e.value.task_type_id,"onUpdate:modelValue":a[2]||(a[2]=f=>e.value.task_type_id=f),label:"Task turi ID",type:"number"},null,8,["modelValue"]),l(v,{modelValue:e.value.deadline_start,"onUpdate:modelValue":a[3]||(a[3]=f=>e.value.deadline_start=f),label:"Boshlanish vaqti",type:"datetime-local"},null,8,["modelValue"]),l(v,{modelValue:e.value.deadline_end,"onUpdate:modelValue":a[4]||(a[4]=f=>e.value.deadline_end=f),label:"Tugash vaqti",type:"datetime-local"},null,8,["modelValue"]),l(V,{modelValue:e.value.description,"onUpdate:modelValue":a[5]||(a[5]=f=>e.value.description=f),label:"Izoh",rows:"4",customClass:"col-span-full"},null,8,["modelValue"]),t("div",Je,[t("div",Oe,[a[8]||(a[8]=t("h3",{class:"font-semibold text-gray-700"},"Ijrochilar",-1)),l($,{variant:"outline",size:"xs",onClick:H(U,["prevent"])},{default:x(()=>[l(d(O),{class:"w-4 h-4"}),a[7]||(a[7]=C(" Qo‘shish ",-1))]),_:1})]),(n(!0),_(B,null,A(e.value.executor,(f,z)=>(n(),_("div",{key:z,class:"grid grid-cols-1 md:grid-cols-2 gap-3 border p-3 rounded-lg relative"},[l(P,{modelValue:f.user_id,"onUpdate:modelValue":I=>f.user_id=I,options:m.value,"option-label":"firstname","option-value":"id",placeholder:"Foydalanuvchini tanlang"},null,8,["modelValue","onUpdate:modelValue","options"]),e.value.executor.length>1?(n(),j($,{key:0,variant:"hover",class:"absolute top-3 right-3",onClick:H(I=>b(z),["prevent"])},{default:x(()=>[l(d(pe),{class:"w-4 h-4 text-red-500"})]),_:1},8,["onClick"])):T("",!0)]))),128))])],32)]),t("div",We,[l($,{onClick:c},{default:x(()=>[...a[9]||(a[9]=[C("Bekor qilish",-1)])]),_:1}),l($,{type:"submit",variant:"primary",onClick:w},{default:x(()=>[...a[10]||(a[10]=[C("Saqlash va yuborish",-1)])]),_:1})])])}}},et={class:"mx-auto"},tt={class:"grid grid-cols-1 lg:grid-cols-12"},lt={class:"col-span-12 md:col-span-4 2xl:col-span-3"},st={class:"card-dark border-b-2 border-x shadow-sm"},ot={class:"flex px-1 py-3 items-center border-b card-border justify-between"},at={class:"flex items-center"},it={class:"flex gap-1"},nt={class:"h-[calc(100vh-8rem)] overflow-y-auto"},rt={class:"col-span-12 md:col-span-8 2xl:col-span-9 space-y-2 px-10 h-[calc(100vh-4rem)] overflow-y-auto"},ut={key:0,class:"card-dark rounded-b-lg border-b-2 border-x shadow-sm"},dt={class:"flex px-1 py-2 items-center border-b card-border justify-between"},ct={class:"flex items-center gap-2"},St={__name:"TransmittedViews",setup(s){const r=W(),u=K(),o=q(null),g=q(null),y=b=>r.fetchAll(b);function e(){o.value&&u.open(Ze,{id:o.value.id})}function m(){o.value&&u.open(Qe,{id:o.value.id})}function U(b){g.value=b.id,o.value=b}return se(()=>r.docks,b=>{if(o.value){const c=b.find(w=>w.id===o.value.id);c&&(o.value=c)}},{deep:!0}),L(async()=>{await r.fetchAll()}),(b,c)=>{const w=ae("wave");return n(),_("div",et,[t("div",tt,[t("div",lt,[t("div",st,[t("div",ot,[t("div",at,[oe((n(),j(N,{variant:"hover"},{default:x(()=>[l(d(re),{"stroke-width":"2",class:"w-6 h-6"})]),_:1})),[[w]]),c[0]||(c[0]=t("h2",{class:"text-[14px] p-2 font-bold uppercase text-[#282F3D]"},"Hujjatlar ro‘yxati",-1))]),t("div",it,[l(ke,{total:d(r).pagination.total,currentPage:d(r).pagination.current_page,lastPage:d(r).pagination.last_page,onChange:y},null,8,["total","currentPage","lastPage"])])]),t("div",nt,[(n(!0),_(B,null,A(d(r).docks,k=>(n(),j(Ce,{key:k.id,dock:k,active:g.value===k.id,onSelect:U},null,8,["dock","active"]))),128)),c[1]||(c[1]=t("div",{class:"h-24 w-full"},null,-1))])])]),t("div",rt,[o.value?(n(),_("div",ut,[t("div",dt,[c[4]||(c[4]=t("h2",{class:"text-[14px] p-2 font-bold uppercase text-[#282F3D]"},"Kiruvchi hujjat",-1)),t("div",ct,[o.value?(n(),j(N,{key:0,onClick:e,variant:"primary"},{default:x(()=>[l(d(O),{"stroke-width":"3",class:"text-white"}),c[2]||(c[2]=t("span",{class:"px-1"},"Ijrochi biriktirish",-1))]),_:1})):T("",!0),o.value?(n(),j(N,{key:1,onClick:m,variant:"primary"},{default:x(()=>[...c[3]||(c[3]=[C(" Tahrirlash ",-1)])]),_:1})):T("",!0)])]),l(He,{class:"p-[24px]",dockfile:o.value},null,8,["dockfile"])])):(n(),j(ue,{key:1}))])])])}}};export{St as default};
