import"./dayjs.min-DN31ES9y.js";import{H as X,_ as y,a as K,b as Q,u as R,U as G,S as Z}from"./dockStore-DStlD6rO.js";import{a as O,r as F,e as b,o as m,f as t,t as w,h as U,i as l,j as k,g as d,v as Y,c as j,s as I,F as P,z as L,b as z,D as ee,M as S,B as $,N as J,m as B,O as te,w as le,L as q,y as H,x as oe}from"./index-DCLUjSd_.js";import{X as ae,_ as se}from"./UPagination-D8LLbMNM.js";import{S as ne}from"./square-pen-wti6APga.js";import"./eye-9JzsAhmB.js";import"./chevron-right-DAGNtmL3.js";/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=O("circle-plus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=O("cloud-upload",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]]);/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=O("logs",[["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M3 12h1",key:"lp3yf2"}],["path",{d:"M3 18h1",key:"1eiwyy"}],["path",{d:"M3 6h1",key:"rgxa97"}],["path",{d:"M8 12h1",key:"1con00"}],["path",{d:"M8 18h1",key:"13wk12"}],["path",{d:"M8 6h1",key:"tn6mkg"}]]),ce={class:"flex flex-col md:flex-row md:items-start justify-between gap-4 md:gap-6"},ue={class:"flex-1 min-w-0"},me={class:"text-xl font-semibold text-zinc-800 dark:text-white/90"},he={class:"flex flex-col gap-1 font-medium text-md"},pe={class:"flex-1 min-w-0 truncate"},fe={class:"flex gap-1"},ge={class:"card-dark mt-2 inline-flex rounded border px-2 py-0.5 text-md font-semibold truncate max-w-full"},ve={class:"card-dark mt-2 inline-flex rounded border px-2 py-0.5 text-md font-semibold truncate max-w-full"},ye={class:"card-dark mt-2 inline-flex rounded border px-2 py-0.5 text-md font-semibold truncate max-w-full"},be={class:"flex-shrink-0 mt-2 md:mt-0"},_e="task card-dark border-b px-2 py-2 cursor-pointer hover:bg-zinc-100 dark:hover:bg-zinc-600/50",ke={__name:"DockListItem",props:{dock:{type:Object,required:!0},active:{type:Boolean,default:!1}},setup(e){return(s,n)=>{const c=F("UTooltip");return m(),b("div",{onClick:n[0]||(n[0]=u=>s.$emit("select",e.dock)),class:Y([[_e,e.active?"bg-blue-100":""],"task px-2 py-2 cursor-pointer hover:bg-blue-200 dark:hover:bg-zinc-600/50"])},[t("div",ce,[t("div",ue,[t("h4",me,"SSV-"+w(e.dock.id)+"/05",1),t("div",he,[t("span",pe,[n[1]||(n[1]=t("span",{class:"font-semibold whitespace-nowrap"},"Mazmun:",-1)),U(" "+w(e.dock.short_content?.slice(0,200))+w((e.dock.short_content?.length??0)>50?"...":""),1)])]),t("div",fe,[l(c,{text:"Ijrochi",position:"bottom"},{default:k(()=>[t("span",ge,w(e.dock.executor),1)]),_:1}),l(c,{text:"Kirish raqami",position:"bottom"},{default:k(()=>[t("span",ve,w(e.dock.incoming_number),1)]),_:1}),l(c,{text:"Chiqish raqami",position:"bottom"},{default:k(()=>[t("span",ye,w(e.dock.outgoing_number),1)]),_:1})])]),t("div",be,[l(c,{text:"Ijro holatida",position:"top"},{default:k(()=>[l(d(X),{class:"w-5 h-5 text-blue-500"})]),_:1})])])],2)}}},xe={key:0},we={class:"grid grid-cols-1 md:grid-cols-2 gap-4 pb-4"},je={key:0},Ve={class:"space-y-2"},ze={__name:"DockShowItem",props:{dockfile:{type:Object,default:null}},setup(e){return(s,n)=>e.dockfile?(m(),b("div",xe,[t("div",we,[l(y,{label:"Kelib tushgan raqam",value:e.dockfile.incoming_number},null,8,["value"]),l(y,{label:"Chiqish raqami",value:e.dockfile.outgoing_number},null,8,["value"]),l(y,{label:"Hujjat nomi",value:e.dockfile.document_name,class:"md:col-span-2"},null,8,["value"]),l(y,{label:"Ijrochi",value:e.dockfile.executor},null,8,["value"]),l(y,{label:"Telefon raqam",value:e.dockfile.phone_number},null,8,["value"]),l(y,{label:"Holati",value:e.dockfile.status_id},null,8,["value"]),l(y,{label:"Qisqa mazmun",value:e.dockfile.short_content,class:"md:col-span-2"},null,8,["value"]),l(y,{label:"Izoh",value:e.dockfile.description,class:"md:col-span-2"},null,8,["value"]),l(y,{label:"Tashkilot",value:e.dockfile.organization_name_oz},null,8,["value"]),l(y,{label:"Hujjat turi",value:e.dockfile.doc_type_name_oz},null,8,["value"]),l(y,{label:"Yetkazib berish usuli",value:e.dockfile.delivery_methods_name_oz},null,8,["value"]),l(y,{label:"Masala turi",value:e.dockfile.issue_type_name_oz},null,8,["value"])]),e.dockfile.files?.length?(m(),b("div",je,[n[0]||(n[0]=t("h3",{class:"font-semibold mb-2"},"Fayllar:",-1)),t("div",Ve,[(m(!0),b(P,null,L(e.dockfile.files,c=>(m(),j(K,{key:c.id,file:c},null,8,["file"]))),128))])])):I("",!0)])):(m(),j(Q,{key:1}))}},Se={class:"flex flex-col gap-2 w-full"},$e={key:0,class:"text-md font-semibold text-dark"},De={class:"relative border-2 border-dashed rounded p-6 flex flex-col items-center justify-center cursor-pointer bg-white hover:bg-blue-50 dark:bg-zinc-700 dark:hover:bg-zinc-600 transition duration-200 shadow-sm hover:shadow-md"},Ue={class:"flex flex-col items-center justify-center text-zinc-400 dark:text-zinc-300 transition-transform duration-150"},Ce=["multiple","accept"],Fe={class:"mt-3 text-xs text-zinc-500 dark:text-zinc-400 select-none"},Me={key:1,class:"mt-2 space-y-2 max-h-72 overflow-y-auto"},qe={__name:"UFileInput",props:{label:String,multiple:{type:Boolean,default:!1},accept:{type:String,default:""},modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue","change"],setup(e,{emit:s}){const n=e,c=s,u=z([...n.modelValue]),p=z(null);ee(()=>n.modelValue,f=>{u.value=[...f]});const x=f=>{const _=Array.from(f.target.files);if(!_.length)return;const i=_.map(o=>Object.assign(o,{isLocal:!0}));u.value=n.multiple?[...u.value,...i]:i,c("update:modelValue",u.value),c("change",u.value),p.value.value=""},v=f=>{u.value=u.value.filter(_=>_!==f),c("update:modelValue",u.value)};return(f,_)=>(m(),b("div",Se,[e.label?(m(),b("label",$e,w(e.label),1)):I("",!0),t("div",De,[t("div",Ue,[l(d(re),{class:"w-14 h-14 mb-3"}),_[0]||(_[0]=t("p",{class:"text-sm text-zinc-700 dark:text-zinc-200 text-center leading-snug"},[U(" Faylni shu yerga "),t("span",{class:"text-blue-600 font-semibold"},"tortib keltiring"),U(),t("br"),U(" yoki "),t("span",{class:"text-blue-600 font-semibold"},"tanlang")],-1))]),t("input",{ref_key:"fileInput",ref:p,type:"file",class:"absolute inset-0 opacity-0 cursor-pointer",multiple:e.multiple,accept:e.accept,onChange:x},null,40,Ce),t("p",Fe,w(e.multiple?"Bir nechta fayllarni tanlang yoki tashlang":"Faylni tanlang yoki tashlang"),1)]),u.value.length?(m(),b("div",Me,[(m(!0),b(P,null,L(u.value,i=>(m(),j(K,{key:i.name,file:i,onRemove:v},null,8,["file"]))),128))])):(m(),j(Q,{key:2}))]))}},Ie=e=>S.post("/incoming_document_draft",e),Te=$("draftDock",{state:()=>({data:null,loading:!1,error:null}),actions:{async createDraft(e){this.loading=!0,this.error=null;try{const s=await Ie(e);return this.data=s.data,s}catch(s){throw this.error=s.message,console.error("Draft yaratishda xato:",s),s}finally{this.loading=!1}}}}),Ae=()=>S.get("/organizations_list"),He=$("organizations",{state:()=>({organizations:[],selectedOrganizations:null,loading:!1,error:null}),actions:{async fetchAll(){try{this.loading=!0;const e=await Ae();this.organizations=e.data}catch(e){this.error=e,console.error("Organizations olishda xato:",e)}finally{this.loading=!1}}}}),Be=()=>S.get("/doctype_list"),Oe=$("doctypes",{state:()=>({doctypes:[],selectedDoctypes:null,loading:!1,error:null}),actions:{async fetchAll(){try{this.loading=!0;const e=await Be();this.doctypes=e.data}catch(e){this.error=e,console.error("Doctypes olishda xato:",e)}finally{this.loading=!1}}}}),Pe=()=>S.get("/delivery_type_list"),Le=$("delivery",{state:()=>({delivery:[],selectedDelivery:null,loading:!1,error:null}),actions:{async fetchAll(){try{this.loading=!0;const e=await Pe();this.delivery=e.data}catch(e){this.error=e,console.error("Delivery olishda xato:",e)}finally{this.loading=!1}}}}),Ne=()=>S.get("/subject_list"),Ee=$("subjects",{state:()=>({subjects:[],selectedSubject:null,loading:!1,error:null}),actions:{async fetchAll(){try{this.loading=!0;const e=await Ne();this.subjects=e.data}catch(e){this.error=e,console.error("Organizations olishda xato:",e)}finally{this.loading=!1}}}}),Ke=(e,s)=>S.post(`file-upload?task_id=${s}`,e,{headers:{"Content-Type":"multipart/form-data"}}),Qe=$("fileupload",{state:()=>({files:[],response:[],error:null}),actions:{setFiles(e){this.files=e},async upload(e){if(this.files.length){this.response=[],this.error=null;try{const s=new FormData;this.files.forEach(c=>{s.append("files[]",c)});const n=await Ke(s,e);return this.response=n.data||[],this.response}catch(s){throw this.error=s.response?.data||s.message||s,this.error}}},clear(){this.files=[],this.response=[],this.error=null}}}),Re=e=>S.post("/document_file_create",e),Ye=$("documentfilecreate",{state:()=>({response:null,error:null,loading:!1}),actions:{async createFiles(e,s){if(!e||!s?.length){this.error="Draft ID yoki fayl ro'yxati bo'sh";return}this.loading=!0,this.response=null,this.error=null;try{const n={incoming_documents_id:e,files:s.map(u=>({url:u.url,type:u.type||"main"}))},c=await Re(n);return this.response=c.data||c,this.response}catch(n){throw this.error=n.response?.data||n.message||n,this.error}finally{this.loading=!1}},clear(){this.response=null,this.error=null,this.loading=!1}}}),Je={class:"flex flex-col w-screen h-screen p-1"},We={class:"justify-between border-b modal-card flex items-center p-4"},Xe={class:"text-dark text-lg font-semibold"},Ge={class:"overflow-y-auto px-16 py-6 flex flex-col gap-6"},Ze={class:"flex-1 grid grid-cols-1 md:grid-cols-2 gap-4"},et={class:"w-full lg:w-1/3 flex-shrink-0"},tt={class:"flex justify-end gap-3 p-4 border-t card-border"},E={__name:"DockFormViews",props:{dock:{type:Object,default:null}},setup(e){const s=Te(),n=R(),c=He(),u=Oe(),p=Le(),x=Ee(),v=Qe(),f=Ye(),_=J(),i=e;B(()=>{console.log("props.dock onMounted:",i.dock)});const o=te({organization_id:i.dock?.organization_id??"",doc_type_id:i.dock?.doc_type_id??"",delivery_method_id:i.dock?.delivery_method_id??"",subject_id:i.dock?.subject_id??"",incoming_number:i.dock?.incoming_number??"",outgoing_number:i.dock?.outgoing_number??"",document_name:i.dock?.document_name??"",short_content:i.dock?.short_content??"",signed_by:i.dock?.signed_by??"",executor:i.dock?.executor??"",phone_number:i.dock?.phone_number??""}),g=z(null),V=z(null);B(async()=>{const h=localStorage.getItem("user");if(h)try{V.value=JSON.parse(h)?.id}catch{}if(await Promise.all([c.fetchAll(),u.fetchAll(),p.fetchAll(),x.fetchAll()]),V.value&&!i.dock){const{data:a}=await s.createDraft({user_id:V.value});g.value=a?.incoming_document_create_id}});const C=async h=>!h||!v.files.length?!1:(await v.upload(h),v.response?.length&&await f.createFiles(h,v.response),!0),N=async()=>{try{const h=i.dock?.id||g.value;if(!h)return;await(i.dock?n.updateDock(h,o):n.createDock(h,o)),await C(h),T()}catch(h){console.error(h)}},T=()=>{v.clear(),_.close()};return(h,a)=>{const A=F("UButton"),M=F("USelect"),D=F("UInput"),W=F("UTextarea");return m(),b("div",Je,[t("div",We,[t("p",Xe,w(i.dock?"Hujjatni tahrirlash":"Hujjat yaratish"),1),l(A,{variant:"hover",onClick:T},{default:k(()=>[l(d(ae),{class:"w-5 h-5"})]),_:1})]),t("div",Ge,[t("form",{onSubmit:le(N,["prevent"]),class:"flex flex-col lg:flex-row gap-6"},[t("div",Ze,[l(M,{modelValue:o.organization_id,"onUpdate:modelValue":a[0]||(a[0]=r=>o.organization_id=r),options:d(c).organizations,label:"Tashkilot",placeholder:"Tashkilot tanlang","option-label":"name_oz","option-value":"id",loading:d(c).loading},null,8,["modelValue","options","loading"]),l(M,{modelValue:o.doc_type_id,"onUpdate:modelValue":a[1]||(a[1]=r=>o.doc_type_id=r),options:d(u).doctypes,label:"Hujjat turi",placeholder:"Tanlang","option-label":"name_oz","option-value":"id",loading:d(u).loading},null,8,["modelValue","options","loading"]),l(M,{modelValue:o.delivery_method_id,"onUpdate:modelValue":a[2]||(a[2]=r=>o.delivery_method_id=r),options:d(p).delivery,label:"Yetkazish usuli",placeholder:"Tanlang","option-label":"name_oz","option-value":"id",loading:d(p).loading},null,8,["modelValue","options","loading"]),l(M,{modelValue:o.subject_id,"onUpdate:modelValue":a[3]||(a[3]=r=>o.subject_id=r),options:d(x).subjects,label:"Mavzu",placeholder:"Tanlang","option-label":"name_oz","option-value":"id",loading:d(x).loading},null,8,["modelValue","options","loading"]),l(D,{modelValue:o.incoming_number,"onUpdate:modelValue":a[4]||(a[4]=r=>o.incoming_number=r),label:"Kiruvchi raqam"},null,8,["modelValue"]),l(D,{modelValue:o.outgoing_number,"onUpdate:modelValue":a[5]||(a[5]=r=>o.outgoing_number=r),label:"Chiquvchi raqam"},null,8,["modelValue"]),l(D,{modelValue:o.document_name,"onUpdate:modelValue":a[6]||(a[6]=r=>o.document_name=r),label:"Hujjat nomi"},null,8,["modelValue"]),l(D,{modelValue:o.signed_by,"onUpdate:modelValue":a[7]||(a[7]=r=>o.signed_by=r),label:"Imzolovchi"},null,8,["modelValue"]),l(D,{modelValue:o.executor,"onUpdate:modelValue":a[8]||(a[8]=r=>o.executor=r),label:"Ijrochi"},null,8,["modelValue"]),l(D,{modelValue:o.phone_number,"onUpdate:modelValue":a[9]||(a[9]=r=>o.phone_number=r),label:"Telefon raqam"},null,8,["modelValue"]),l(W,{modelValue:o.short_content,"onUpdate:modelValue":a[10]||(a[10]=r=>o.short_content=r),label:"Qisqacha mazmun"},null,8,["modelValue"])]),t("div",et,[l(qe,{modelValue:d(v).files,"onUpdate:modelValue":a[11]||(a[11]=r=>d(v).files=r),label:"Hujjat",multiple:"",accept:".pdf,.docx,.jpg,.png"},null,8,["modelValue"])])],32)]),t("div",tt,[l(A,{onClick:T,disabled:d(n).loading},{default:k(()=>[...a[12]||(a[12]=[U("Bekor qilish",-1)])]),_:1},8,["disabled"]),l(A,{onClick:N,loading:d(n).loading,variant:"primary"},{default:k(()=>[...a[13]||(a[13]=[U(" Saqlash va yuborish ",-1)])]),_:1},8,["loading"])])])}}},lt={class:"mx-auto"},ot={class:"w-full"},at={class:"card-dark flex items-center w-full h-full rounded justify-between pr-2"},st={class:"grid grid-cols-1 lg:grid-cols-12"},nt={class:"card-dark border"},it={class:"flex px-1 py-2 items-center border-b card-border justify-between"},rt={class:"h-[calc(100vh-8rem)] overflow-y-auto"},dt={key:0,class:"space-y-2 lg:col-span-4 2xl:col-span-4 pb-10"},ct={class:"card-dark border"},ut={class:"flex px-1 py-2 items-center border-b card-border justify-between"},mt={class:"h-[calc(100vh-8rem)] overflow-y-auto"},_t={__name:"TransmittedViews",setup(e){const s=o=>p.fetchAll(o),n=J();function c(){n.open(E)}function u(){n.open(E,{dock:x.value})}const p=R(),x=z(null),v=z(null),f=z(!0);function _(){f.value=!f.value}B(async()=>{await p.fetchAll()});const i=o=>{v.value=o.id,x.value=o};return(o,g)=>{const V=oe("wave");return m(),b("div",lt,[t("div",null,[t("div",ot,[t("div",at,[l(G),t("div",null,[l(q,{onClick:c,variant:"primary"},{default:k(()=>[l(d(ie),{class:"w-5 h-5"}),g[0]||(g[0]=t("span",{class:"px-1"},"Hujjat yaratish",-1))]),_:1})])])]),t("div",st,[t("div",{class:Y(f.value?"lg:col-span-8 2xl:col-span-8":"lg:col-span-12 2xl:col-span-12")},[t("div",nt,[t("div",it,[g[1]||(g[1]=t("h2",{class:"text-lg font-semibold text-dark"},"Topshiriqlar",-1)),t("div",null,[H((m(),j(q,{variant:"hover"},{default:k(()=>[l(d(Z),{"stroke-width":1,class:"w-6 h-6"})]),_:1})),[[V]]),H((m(),j(q,{variant:"hover",onClick:_},{default:k(()=>[l(d(de),{"stroke-width":1,class:"w-6 h-6"})]),_:1})),[[V]])])]),t("div",rt,[(m(!0),b(P,null,L(d(p).docks,C=>H((m(),j(ke,{key:C.id,dock:C,active:v.value===C.id,onSelect:i},null,8,["dock","active"])),[[V]])),128)),l(se,{total:d(p).pagination.total,currentPage:d(p).pagination.current_page,lastPage:d(p).pagination.last_page,onChange:s},null,8,["total","currentPage","lastPage"]),g[2]||(g[2]=t("div",{class:"h-24 w-full"},null,-1))])])],2),f.value?(m(),b("div",dt,[t("div",ct,[t("div",ut,[g[3]||(g[3]=t("h2",{class:"text-lg font-semibold text-dark"},"Hujjat",-1)),x.value?(m(),j(q,{key:0,onClick:u,variant:"hover"},{default:k(()=>[l(d(ne),{"stroke-width":1,class:"w-6 h-6"})]),_:1})):I("",!0)]),t("div",mt,[l(ze,{class:"p-2",dockfile:x.value},null,8,["dockfile"]),g[4]||(g[4]=t("div",{class:"h-24 w-full"},null,-1))])])])):I("",!0)])])])}}};export{_t as default};
