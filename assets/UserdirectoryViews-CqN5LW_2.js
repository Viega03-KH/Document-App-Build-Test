import{a as T,e as y,o as x,f as a,F,z as I,t as _,N as k,B as j,u as M,L as q,r as b,i as o,j as f,g as e,h as $,b as O,m as P,w as R,H as X}from"./index-BI14Y88U.js";import{_ as H}from"./UPagination-DwUj9Zqo.js";import{X as A,u as Y,S as G}from"./useFormValidate-CzyOW5d_.js";import{u as J}from"./user-BHq0Hx6z.js";import"./chevron-right-xnhJiUp0.js";/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=T("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]),Q={class:"card-dark text-dark bg-zinc-100 border-b-2"},W={__name:"TheadDock",setup(s){const l=[{key:"id",label:"Foydalanuvchi ID raqami"},{key:"name",label:"To‘liq ism va elektron pochta"},{key:"departments_id",label:"Foydalanuvchi roli"},{key:"role_names",label:"Bo‘lim yoki lavozim nomi"},{key:"created_at",label:"Yaratilgan sana va vaqt"},{key:"actions",label:"Amallar (tahrirlash / o‘chirish)"}];return(r,h)=>(x(),y("thead",Q,[a("tr",null,[(x(),y(F,null,I(l,n=>a("th",{key:n.key,class:"px-4 text-start py-3.5 sm:px-6"},_(n.label),1)),64))])]))}},Z=(s=1)=>k.get(`/user_list?page=${s}`),ee=s=>k.post("/user_create",s),te=s=>k.get(`/user_show/${s}`),ae=(s,l)=>k.put(`/user_update/${s}`,l),se=s=>k.delete(`/user_destroy/${s}`),C=j("users",{state:()=>({users:[],pagination:{current_page:1,last_page:1,total:0},selectedUser:null,loading:!1,error:null}),actions:{async fetchUsers(s=null){this.loading=!0,this.error=null;try{const l=s||this.pagination.current_page,r=await Z(l);this.users=r.data.data||r.data,this.pagination.current_page=r.data.current_page,this.pagination.last_page=r.data.last_page,this.pagination.total=r.data.total}catch(l){this.error=l.message}finally{this.loading=!1}},async fetchUser(s){this.loading=!0;try{const l=await te(s);return this.selectedUser=l.data,l.data}catch(l){this.error=l.message}finally{this.loading=!1}},async addUser(s){this.loading=!0;try{return await ee(s),await this.fetchUsers(),{success:!0}}catch(l){return this.error=l.message,{success:!1,error:l.message}}finally{this.loading=!1}},async editUser(s,l){this.loading=!0,this.error=null;try{const r=await ae(s,l);return await this.fetchUsers(),{success:!0,data:r.data}}catch(r){return this.error=r.message,{success:!1,error:this.error}}finally{this.loading=!1}},async removeUser(s){this.loading=!0;try{await se(s),await this.fetchUsers()}catch(l){this.error=l.message}finally{this.loading=!1}}}}),le={class:"max-w-xl max-h-xl"},re={class:"justify-between border-b modal-card flex items-center p-4"},oe={class:"justify-end border-t modal-card flex gap-2 p-4"},ne={__name:"UserDelete",props:{userId:{type:Number,required:!0}},setup(s){const l=s,r=C(),h=M(),n=q(),g=async()=>{try{await r.removeUser(l.userId),h.show("Foydalanuvchi muvaffaqiyatli o‘chirildi!","success"),n.close()}catch(v){h.show("Xatolik yuz berdi!","error"),console.error(v)}};return(v,c)=>{const w=b("UButton");return x(),y("div",le,[a("div",re,[c[2]||(c[2]=a("p",{class:"text-dark text-lg font-semibold"},"Foydalanuvchini o‘chirish",-1)),o(w,{variant:"hover",onClick:c[0]||(c[0]=t=>e(n).close())},{default:f(()=>[o(e(A),{class:"w-5 h-5"})]),_:1})]),c[5]||(c[5]=a("div",{class:"p-4 text-center space-y-4"},[a("p",{class:"text-base text-dark"}," Siz rostdan ham bu foydalanuvchini o‘chirmoqchimisiz? ")],-1)),a("div",oe,[o(w,{onClick:c[1]||(c[1]=t=>e(n).close()),disabled:e(r).loading},{default:f(()=>[...c[3]||(c[3]=[$(" Bekor qilish ",-1)])]),_:1},8,["disabled"]),o(w,{variant:"danger",onClick:g,loading:e(r).loading},{default:f(()=>[...c[4]||(c[4]=[$(" O‘chirish ",-1)])]),_:1},8,["loading"])])])}}},ie=()=>k.get("/roles_list"),de=j("rolls",{state:()=>({rolls:[],selectedRoll:null,loading:!1,error:null}),actions:{async fetchAll(){try{this.loading=!0;const s=await ie();this.rolls=s.data}catch(s){this.error=s,console.error("Rolllarni olishda xato:",s)}finally{this.loading=!1}}}}),ce=()=>k.get("/department_list"),E=j("departments",{state:()=>({departments:[],selectedDepartment:null,loading:!1,error:null}),actions:{async fetchAll(){try{this.loading=!0;const s=await ce();this.departments=s.data}catch(s){this.error=s,console.error("Departmentlarni olishda xato:",s)}finally{this.loading=!1}}}}),ue={class:"flex flex-col max-w-2xl"},me={class:"justify-between border-b modal-card flex items-center p-4"},pe={class:"text-dark text-lg font-semibold"},he={class:"flex flex-wrap -mx-2 p-4"},fe={class:"w-full px-2 py-2 xl:w-1/2"},_e={class:"w-full px-2 py-2 xl:w-1/2"},ge={class:"w-full px-2 py-2 xl:w-1/2"},ye={class:"w-full px-2 py-2 xl:w-1/2"},xe={class:"w-full px-2 py-2 xl:w-1/2"},ve={class:"w-full px-2 py-2 xl:w-1/2"},we={class:"w-full px-2 py-2 xl:w-1/2"},be={class:"w-full px-2 py-2 xl:w-1/2"},ke={class:"border-t modal-card flex justify-end gap-2 pt-4"},L={__name:"UserForm",props:{userId:{type:Number,default:null}},setup(s){const l=s,r=C(),h=de(),n=E(),g=M(),v=q(),c={id:null,name:"",email:"",lastname:"",firstname:"",middlename:"",department_id:null,role:"",password:""},w={name:{required:!0,message:"Ism majburiy"},email:{required:!0,message:"Email majburiy"},lastname:{required:!0,message:"Familiya majburiy"},firstname:{required:!0,message:"Sharif majburiy"},middlename:{required:!0,message:"Otasining ismi majburiy"},department_id:{required:!0,message:"Bo‘lim majburiy"},role:{required:!0,message:"Lavozim majburiy"},password:{required:!1}},{form:t,errors:p,validate:V,resetForm:z}=Y(c,w),u=O(!1);P(async()=>{if(h.rolls.length||await h.fetchAll(),n.departments.length||await n.fetchAll(),l.userId){u.value=!0,await r.fetchUser(l.userId);const i=r.selectedUser;console.log(i),i&&(t.id=i.id,t.name=i.name,t.lastname=i.lastname,t.firstname=i.firstname,t.middlename=i.middlename,t.email=i.email,t.department_id=i.department_id,t.role=i.role)}});const S=()=>{z(),v.close()},N=async()=>{if(V())try{const i={...t};i.password||delete i.password,u.value?await r.editUser(t.id,i):await r.addUser(i),S(),g.show("Barchasi muvaffaqiyatli!","success")}catch(i){g.show(i?.response?.data?.message||"Xatolik yuz berdi","error"),console.error(i)}};return(i,d)=>{const B=b("UButton"),U=b("UInput"),D=b("USelect");return x(),y("div",ue,[a("div",me,[a("p",pe,_(u.value?"Foydalanuvchini tahrirlash":"Foydalanuvchi qo‘shish"),1),o(B,{variant:"hover",onClick:S},{default:f(()=>[o(e(A),{class:"w-5 h-5"})]),_:1})]),a("form",{onSubmit:R(N,["prevent"]),class:"space-y-6"},[a("div",he,[a("div",fe,[o(U,{modelValue:e(t).name,"onUpdate:modelValue":d[0]||(d[0]=m=>e(t).name=m),label:"Ism",placeholder:"Ismingizni kiriting",error:e(p).name},null,8,["modelValue","error"])]),a("div",_e,[o(U,{modelValue:e(t).email,"onUpdate:modelValue":d[1]||(d[1]=m=>e(t).email=m),label:"Email",placeholder:"Email manzilingizni kiriting",error:e(p).email},null,8,["modelValue","error"])]),a("div",ge,[o(U,{modelValue:e(t).lastname,"onUpdate:modelValue":d[2]||(d[2]=m=>e(t).lastname=m),label:"Familiya",placeholder:"Familiyangizni kiriting",error:e(p).lastname},null,8,["modelValue","error"])]),a("div",ye,[o(U,{modelValue:e(t).firstname,"onUpdate:modelValue":d[3]||(d[3]=m=>e(t).firstname=m),label:"Sharif",placeholder:"Sharifingizni kiriting",error:e(p).firstname},null,8,["modelValue","error"])]),a("div",xe,[o(U,{modelValue:e(t).middlename,"onUpdate:modelValue":d[4]||(d[4]=m=>e(t).middlename=m),label:"Otasining ismi",placeholder:"Otasining ismini kiriting",error:e(p).middlename},null,8,["modelValue","error"])]),a("div",ve,[o(D,{modelValue:e(t).department_id,"onUpdate:modelValue":d[5]||(d[5]=m=>e(t).department_id=m),label:"Bo‘lim",options:e(n).departments,"option-label":"name_oz","option-value":"id",placeholder:"Bo‘limni tanlang",error:e(p).department_id},null,8,["modelValue","options","error"])]),a("div",we,[o(D,{modelValue:e(t).role,"onUpdate:modelValue":d[6]||(d[6]=m=>e(t).role=m),label:"Lavozim",options:e(h).rolls,"option-label":"name","option-value":"name",placeholder:"Lavozimni tanlang",error:e(p).role},null,8,["modelValue","options","error"])]),a("div",be,[o(U,{modelValue:e(t).password,"onUpdate:modelValue":d[7]||(d[7]=m=>e(t).password=m),type:"password",label:"Parol",placeholder:"Parolni yangilamoqchi bo‘lsangiz kiriting",error:e(p).password},null,8,["modelValue","error"])])]),a("div",ke,[o(B,{type:"button",onClick:S,disabled:e(r).loading},{default:f(()=>[...d[8]||(d[8]=[$(" Bekor qilish ",-1)])]),_:1},8,["disabled"]),o(B,{type:"submit",variant:"primary",loading:e(r).loading},{default:f(()=>[$(_(u.value?"Yangilash":"Saqlash"),1)]),_:1},8,["loading"])])],32)])}}},Ue={class:"min-w-full"},$e={class:"divide-y dark:divide-zinc-600 divide-zinc-100"},Ve={class:"px-4 py-3.5 sm:px-6"},ze={class:"font-medium text-dark"},Se={class:"px-4 py-3.5 sm:px-6 flex items-center gap-3"},qe={class:"flex items-center justify-center w-10 h-10 rounded-full bg-zinc-200"},Be=["src"],Fe={class:"block font-medium text-dark"},je={class:"text-zinc-500 dark:text-zinc-400 text-sm"},Ce={class:"px-4 py-3.5 sm:px-6"},De={class:"rounded-full bg-blue-500 px-1 text-zinc-100"},Ie={class:"px-4 py-3.5 sm:px-6"},Me={class:"px-4 py-3.5 sm:px-6"},Pe={class:"px-4 py-3.5 sm:px-6 flex gap-2"},Ae={__name:"UserList",setup(s){const l=C(),r=E(),h=q(),n=t=>l.fetchUsers(t),g=X(()=>{const t=new Map;return r.departments.forEach(p=>t.set(p.id,p.name_oz)),t}),v=t=>g.value.get(t)||"—";P(()=>{Promise.all([l.fetchUsers(),r.fetchAll()])});function c(t){h.open(ne,{userId:t})}function w(t=null){h.open(L,{userId:t})}return(t,p)=>{const V=b("UButton"),z=b("UTooltip");return x(),y(F,null,[a("table",Ue,[o(W),a("tbody",$e,[(x(!0),y(F,null,I(e(l).users,u=>(x(),y("tr",{key:u.id},[a("td",Ve,[a("span",ze,"UserID-"+_(u.id),1)]),a("td",Se,[a("div",qe,[a("img",{src:u.avatar||e(J),class:"rounded-full h-10 w-10"},null,8,Be)]),a("div",null,[a("span",Fe,_(u.name),1),a("span",je,_(u.email),1)])]),a("td",Ce,[a("span",De,_(u.role),1)]),a("td",Ie,_(v(u.department_id)),1),a("td",Me,_(u.created_at),1),a("td",Pe,[o(z,{text:"Foydalanuvchini tahrirlash"},{default:f(()=>[o(V,{onClick:()=>w(u.id),variant:"hover"},{default:f(()=>[o(e(G),{class:"w-5 h-5"})]),_:1},8,["onClick"])]),_:2},1024),o(z,{text:"Foydalanuvchini o‘chirish"},{default:f(()=>[o(V,{onClick:S=>c(u.id),variant:"hover"},{default:f(()=>[o(e(K),{class:"w-5 h-5"})]),_:1},8,["onClick"])]),_:2},1024)])]))),128))])]),o(H,{total:e(l).pagination.total,currentPage:e(l).pagination.current_page,lastPage:e(l).pagination.last_page,onChange:n},null,8,["total","currentPage","lastPage"])],64)}}},Ee={class:"min-h-[80vh] flex flex-col space-y-6 p-6"},Le={class:"flex flex-col gap-5 sm:flex-row sm:items-center sm:justify-between"},Ne={class:"flex-1 overflow-hidden shadow rounded card-dark border"},Te={class:"max-w-full overflow-x-auto custom-scrollbar"},Ge={__name:"UserdirectoryViews",setup(s){const l=q();function r(){l.open(L)}return(h,n)=>{const g=b("UButton");return x(),y("div",Ee,[a("div",Le,[n[2]||(n[2]=a("h3",{class:"text-xl font-bold text-dark"}," Tizim foydalanuvchilari ",-1)),o(g,{variant:"primary",onClick:n[0]||(n[0]=v=>r())},{default:f(()=>[...n[1]||(n[1]=[$("Foydalanuvchi qo‘shish",-1)])]),_:1})]),a("div",Ne,[a("div",Te,[o(Ae)])])])}}};export{Ge as default};
