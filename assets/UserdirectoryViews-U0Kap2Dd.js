import{a as L,e as v,o as w,f as s,F as B,z as I,t as x,M as b,B as F,u as P,N as q,r as U,i as o,j as g,g as t,h as $,O as D,b as R,m as E,X as k,Y as M,w as X,H as Y}from"./index-DCLUjSd_.js";import{X as A,_ as H}from"./UPagination-D8LLbMNM.js";import{u as G}from"./user-BHq0Hx6z.js";import{S as J}from"./square-pen-wti6APga.js";import"./chevron-right-DAGNtmL3.js";/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=L("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]),Q={class:"card-dark text-dark bg-zinc-100 border-b-2"},W={__name:"TheadDock",setup(a){const r=[{key:"id",label:"Foydalanuvchi ID raqami"},{key:"name",label:"To‘liq ism va elektron pochta"},{key:"departments_id",label:"Foydalanuvchi roli"},{key:"role_names",label:"Bo‘lim yoki lavozim nomi"},{key:"created_at",label:"Yaratilgan sana va vaqt"},{key:"actions",label:"Amallar (tahrirlash / o‘chirish)"}];return(l,c)=>(w(),v("thead",Q,[s("tr",null,[(w(),v(B,null,I(r,i=>s("th",{key:i.key,class:"px-4 text-start py-3.5 sm:px-6"},x(i.label),1)),64))])]))}},Z=(a=1)=>b.get(`/user_list?page=${a}`),ee=a=>b.post("/user_create",a),te=a=>b.get(`/user_show/${a}`),ae=(a,r)=>b.put(`/user_update/${a}`,r),se=a=>b.delete(`/user_destroy/${a}`),C=F("users",{state:()=>({users:[],pagination:{current_page:1,last_page:1,total:0},selectedUser:null,loading:!1,error:null}),actions:{async fetchUsers(a=null){this.loading=!0,this.error=null;try{const r=a||this.pagination.current_page,l=await Z(r);this.users=l.data.data||l.data,this.pagination.current_page=l.data.current_page,this.pagination.last_page=l.data.last_page,this.pagination.total=l.data.total}catch(r){this.error=r.message}finally{this.loading=!1}},async fetchUser(a){this.loading=!0;try{const r=await te(a);return this.selectedUser=r.data,r.data}catch(r){this.error=r.message}finally{this.loading=!1}},async addUser(a){this.loading=!0;try{return await ee(a),await this.fetchUsers(),{success:!0}}catch(r){return this.error=r.message,{success:!1,error:r.message}}finally{this.loading=!1}},async editUser(a,r){this.loading=!0,this.error=null;try{const l=await ae(a,r);return await this.fetchUsers(),{success:!0,data:l.data}}catch(l){return this.error=l.message,{success:!1,error:this.error}}finally{this.loading=!1}},async removeUser(a){this.loading=!0;try{await se(a),await this.fetchUsers()}catch(r){this.error=r.message}finally{this.loading=!1}}}}),re={class:"max-w-xl max-h-xl"},le={class:"justify-between border-b modal-card flex items-center p-4"},oe={class:"justify-end border-t modal-card flex gap-2 p-4"},ne={__name:"UserDelete",props:{userId:{type:Number,required:!0}},setup(a){const r=a,l=C(),c=P(),i=q(),y=async()=>{try{await l.removeUser(r.userId),c.show("Foydalanuvchi muvaffaqiyatli o‘chirildi!","success"),i.close()}catch(f){c.show("Xatolik yuz berdi!","error"),console.error(f)}};return(f,n)=>{const _=U("UButton");return w(),v("div",re,[s("div",le,[n[2]||(n[2]=s("p",{class:"text-dark text-lg font-semibold"},"Foydalanuvchini o‘chirish",-1)),o(_,{variant:"hover",onClick:n[0]||(n[0]=e=>t(i).close())},{default:g(()=>[o(t(A),{class:"w-5 h-5"})]),_:1})]),n[5]||(n[5]=s("div",{class:"p-4 text-center space-y-4"},[s("p",{class:"text-base text-dark"}," Siz rostdan ham bu foydalanuvchini o‘chirmoqchimisiz? ")],-1)),s("div",oe,[o(_,{onClick:n[1]||(n[1]=e=>t(i).close()),disabled:t(l).loading},{default:g(()=>[...n[3]||(n[3]=[$(" Bekor qilish ",-1)])]),_:1},8,["disabled"]),o(_,{variant:"danger",onClick:y,loading:t(l).loading},{default:g(()=>[...n[4]||(n[4]=[$(" O‘chirish ",-1)])]),_:1},8,["loading"])])])}}};function ie(a={},r={}){const l=D({...a}),c=D({});return{form:l,errors:c,validate:()=>{let f=!0;for(const n in r){const _=l[n],e=r[n];if(c[n]="",e.required&&(!_||_.toString().trim()==="")&&(c[n]=e.message||"Majburiy maydon",f=!1),e.custom&&typeof e.custom=="function"){const m=e.custom(_,l);m&&(c[n]=m,f=!1)}}return f},resetForm:()=>{Object.assign(l,a),Object.keys(c).forEach(f=>c[f]="")}}}const de=()=>b.get("/roles_list"),ce=F("rolls",{state:()=>({rolls:[],selectedRoll:null,loading:!1,error:null}),actions:{async fetchAll(){try{this.loading=!0;const a=await de();this.rolls=a.data}catch(a){this.error=a,console.error("Rolllarni olishda xato:",a)}finally{this.loading=!1}}}}),ue=()=>b.get("/department_list"),N=F("departments",{state:()=>({departments:[],selectedDepartment:null,loading:!1,error:null}),actions:{async fetchAll(){try{this.loading=!0;const a=await ue();this.departments=a.data}catch(a){this.error=a,console.error("Departmentlarni olishda xato:",a)}finally{this.loading=!1}}}}),me={class:"flex flex-col max-w-2xl"},pe={class:"justify-between border-b modal-card flex items-center p-4"},he={class:"text-dark text-lg font-semibold"},fe={class:"flex flex-wrap -mx-2 p-4"},_e={class:"w-full px-2 py-2 xl:w-1/2"},ge={class:"w-full px-2 py-2 xl:w-1/2"},ye={class:"w-full px-2 py-2 xl:w-1/2"},xe={class:"w-full px-2 py-2 xl:w-1/2"},ve={class:"w-full px-2 py-2 xl:w-1/2"},we={class:"w-full px-2 py-2 xl:w-1/2"},be={class:"w-full px-2 py-2 xl:w-1/2"},ke={class:"w-full px-2 py-2 xl:w-1/2"},Ue={class:"border-t modal-card flex justify-end gap-2 pt-4"},O={__name:"UserForm",props:{userId:{type:Number,default:null}},setup(a){const r=a,l=C(),c=ce(),i=N(),y=P(),f=q(),n={id:null,name:"",email:"",lastname:"",firstname:"",middlename:"",department_id:null,role:"",password:""},_={name:{required:!0,message:"Ism majburiy"},email:{required:!0,message:"Email majburiy"},lastname:{required:!0,message:"Familiya majburiy"},firstname:{required:!0,message:"Sharif majburiy"},middlename:{required:!0,message:"Otasining ismi majburiy"},department_id:{required:!0,message:"Bo‘lim majburiy"},role:{required:!0,message:"Lavozim majburiy"},password:{required:!1}},{form:e,errors:m,validate:V,resetForm:z}=ie(n,_),p=R(!1);E(async()=>{if(c.rolls.length||await c.fetchAll(),i.departments.length||await i.fetchAll(),r.userId){p.value=!0,await l.fetchUser(r.userId);const d=l.selectedUser;console.log(d),d&&(e.id=d.id,e.name=d.name,e.lastname=d.lastname,e.firstname=d.firstname,e.middlename=d.middlename,e.email=d.email,e.department_id=d.department_id,e.role=d.role)}});const S=()=>{z(),f.close()},T=async()=>{if(V())try{const d={...e};d.password||delete d.password,p.value?await l.editUser(e.id,d):await l.addUser(d),S(),y.show("Barchasi muvaffaqiyatli!","success")}catch(d){y.show(d?.response?.data?.message||"Xatolik yuz berdi","error"),console.error(d)}};return(d,u)=>{const j=U("UButton");return w(),v("div",me,[s("div",pe,[s("p",he,x(p.value?"Foydalanuvchini tahrirlash":"Foydalanuvchi qo‘shish"),1),o(j,{variant:"hover",onClick:S},{default:g(()=>[o(t(A),{class:"w-5 h-5"})]),_:1})]),s("form",{onSubmit:X(T,["prevent"]),class:"space-y-6"},[s("div",fe,[s("div",_e,[o(k,{modelValue:t(e).name,"onUpdate:modelValue":u[0]||(u[0]=h=>t(e).name=h),label:"Ism",placeholder:"Ismingizni kiriting",error:t(m).name},null,8,["modelValue","error"])]),s("div",ge,[o(k,{modelValue:t(e).email,"onUpdate:modelValue":u[1]||(u[1]=h=>t(e).email=h),label:"Email",placeholder:"Email manzilingizni kiriting",error:t(m).email},null,8,["modelValue","error"])]),s("div",ye,[o(k,{modelValue:t(e).lastname,"onUpdate:modelValue":u[2]||(u[2]=h=>t(e).lastname=h),label:"Familiya",placeholder:"Familiyangizni kiriting",error:t(m).lastname},null,8,["modelValue","error"])]),s("div",xe,[o(k,{modelValue:t(e).firstname,"onUpdate:modelValue":u[3]||(u[3]=h=>t(e).firstname=h),label:"Sharif",placeholder:"Sharifingizni kiriting",error:t(m).firstname},null,8,["modelValue","error"])]),s("div",ve,[o(k,{modelValue:t(e).middlename,"onUpdate:modelValue":u[4]||(u[4]=h=>t(e).middlename=h),label:"Otasining ismi",placeholder:"Otasining ismini kiriting",error:t(m).middlename},null,8,["modelValue","error"])]),s("div",we,[o(M,{modelValue:t(e).department_id,"onUpdate:modelValue":u[5]||(u[5]=h=>t(e).department_id=h),label:"Bo‘lim",options:t(i).departments,"option-label":"name_oz","option-value":"id",placeholder:"Bo‘limni tanlang",error:t(m).department_id},null,8,["modelValue","options","error"])]),s("div",be,[o(M,{modelValue:t(e).role,"onUpdate:modelValue":u[6]||(u[6]=h=>t(e).role=h),label:"Lavozim",options:t(c).rolls,"option-label":"name","option-value":"name",placeholder:"Lavozimni tanlang",error:t(m).role},null,8,["modelValue","options","error"])]),s("div",ke,[o(k,{modelValue:t(e).password,"onUpdate:modelValue":u[7]||(u[7]=h=>t(e).password=h),type:"password",label:"Parol",placeholder:"Parolni yangilamoqchi bo‘lsangiz kiriting",error:t(m).password},null,8,["modelValue","error"])])]),s("div",Ue,[o(j,{type:"button",onClick:S,disabled:t(l).loading},{default:g(()=>[...u[8]||(u[8]=[$(" Bekor qilish ",-1)])]),_:1},8,["disabled"]),o(j,{type:"submit",variant:"primary",loading:t(l).loading},{default:g(()=>[$(x(p.value?"Yangilash":"Saqlash"),1)]),_:1},8,["loading"])])],32)])}}},$e={class:"min-w-full"},Ve={class:"divide-y dark:divide-zinc-600 divide-zinc-100"},ze={class:"px-4 py-3.5 sm:px-6"},Se={class:"font-medium text-dark"},qe={class:"px-4 py-3.5 sm:px-6 flex items-center gap-3"},je={class:"flex items-center justify-center w-10 h-10 rounded-full bg-zinc-200"},Be=["src"],Fe={class:"block font-medium text-dark"},Ce={class:"text-zinc-500 dark:text-zinc-400 text-sm"},De={class:"px-4 py-3.5 sm:px-6"},Me={class:"rounded-full bg-blue-500 px-1 text-zinc-100"},Ie={class:"px-4 py-3.5 sm:px-6"},Pe={class:"px-4 py-3.5 sm:px-6"},Ee={class:"px-4 py-3.5 sm:px-6 flex gap-2"},Ae={__name:"UserList",setup(a){const r=C(),l=N(),c=q(),i=e=>r.fetchUsers(e),y=Y(()=>{const e=new Map;return l.departments.forEach(m=>e.set(m.id,m.name_oz)),e}),f=e=>y.value.get(e)||"—";E(()=>{Promise.all([r.fetchUsers(),l.fetchAll()])});function n(e){c.open(ne,{userId:e})}function _(e=null){c.open(O,{userId:e})}return(e,m)=>{const V=U("UButton"),z=U("UTooltip");return w(),v(B,null,[s("table",$e,[o(W),s("tbody",Ve,[(w(!0),v(B,null,I(t(r).users,p=>(w(),v("tr",{key:p.id},[s("td",ze,[s("span",Se,"UserID-"+x(p.id),1)]),s("td",qe,[s("div",je,[s("img",{src:p.avatar||t(G),class:"rounded-full h-10 w-10"},null,8,Be)]),s("div",null,[s("span",Fe,x(p.name),1),s("span",Ce,x(p.email),1)])]),s("td",De,[s("span",Me,x(p.role),1)]),s("td",Ie,x(f(p.department_id)),1),s("td",Pe,x(p.created_at),1),s("td",Ee,[o(z,{text:"Foydalanuvchini tahrirlash"},{default:g(()=>[o(V,{onClick:()=>_(p.id),variant:"hover"},{default:g(()=>[o(t(J),{class:"w-5 h-5"})]),_:1},8,["onClick"])]),_:2},1024),o(z,{text:"Foydalanuvchini o‘chirish"},{default:g(()=>[o(V,{onClick:S=>n(p.id),variant:"hover"},{default:g(()=>[o(t(K),{class:"w-5 h-5"})]),_:1},8,["onClick"])]),_:2},1024)])]))),128))])]),o(H,{total:t(r).pagination.total,currentPage:t(r).pagination.current_page,lastPage:t(r).pagination.last_page,onChange:i},null,8,["total","currentPage","lastPage"])],64)}}},Ne={class:"min-h-[80vh] flex flex-col space-y-6 p-6"},Oe={class:"flex flex-col gap-5 sm:flex-row sm:items-center sm:justify-between"},Te={class:"flex-1 overflow-hidden shadow rounded card-dark border"},Le={class:"max-w-full overflow-x-auto custom-scrollbar"},Je={__name:"UserdirectoryViews",setup(a){const r=q();function l(){r.open(O,{close:r.close})}return(c,i)=>{const y=U("UButton");return w(),v("div",Ne,[s("div",Oe,[i[2]||(i[2]=s("h3",{class:"text-xl font-bold text-dark"}," Tizim foydalanuvchilari ",-1)),o(y,{variant:"primary",onClick:i[0]||(i[0]=f=>l())},{default:g(()=>[...i[1]||(i[1]=[$("Foydalanuvchi qo‘shish",-1)])]),_:1})]),s("div",Te,[s("div",Le,[o(Ae)])])])}}};export{Je as default};
